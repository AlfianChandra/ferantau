import{u as ce}from"./theme-DaTZmnjP.js";import{_ as Se}from"./MainWrapperView.vue_vue_type_style_index_0_lang-YVG7Y0LS.js";import{_ as J}from"./SelectView.vue_vue_type_style_index_0_lang-BwjPBPfC.js";import{_ as ae}from"./InputView.vue_vue_type_style_index_0_lang-O1tR2BNy.js";import{_ as R}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-BZ4WUiAV.js";import{t as me}from"./trunk-BWplR3r4.js";import{a as _e}from"./axios-BimPEqV4.js";import{d as ye,h as a,i as be,k as D,r as se,o as u,c as y,e as t,a as o,w as c,p as w,l as _,n as O,u as k,x as te,K as le,b as ie,t as A,f as $e,F as ue,_ as ge,y as fe,m as Fe}from"./index-D1U-VFiV.js";import{i as Ye}from"./index-CehbAW_K.js";import{h as V}from"./moment-C5S46NFB.js";const Pe={key:0,class:"datepickdialog"},Te={class:"datepickinner"},Ve={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Re={key:1,class:"selfnavdialog"},Ae={class:"selfnavdialog-inner"},Le={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ue={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},ze={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Ie={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Ne={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Oe={key:1,style:{"font-size":"11px"}},Be={style:{position:"relative",width:"100%"}},Ee={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},je={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},qe={style:{width:"100%",padding:"10px",position:"relative"}},Ge=["max","value"],Ke={key:0,class:"hmloader"},He=ye({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange"],setup(re,{emit:oe}){const Q=me(),h=oe,m=ce(),M=a("forward"),x=a(!1),n=re,$=a(),C=a(),K=a(Q.getAllTrunk()),r=a(0),z=a(0),I=a([]),B=a(!1),L=a(500);let S=null,N=[];const E={},ne=a(),j=a(""),d=a(""),s=a(!0),v=a(!1),l=a(!1),p=a(!1),q=()=>{C.value=Ye($.value);const f={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};C.value.setOption(f),setTimeout(()=>{C.value.resize()},1e3)};be(()=>{window.addEventListener("keyup",De)}),D(()=>$.value,()=>{q(),G(r.value)}),D(()=>n.initPlaybackData,()=>{b(),q(),B.value=!1,v.value&&(l.value=!0)});const G=f=>{N=[];for(let T of K.value[n.selectedSpot].spot)E[T.name]=[];n.initPlaybackData.slice(0,f+1).forEach((T,i)=>{const ve=`${T.dateFilter} (${T.timeRange})`;N.push(ve),ne.value=ve,T.data.forEach(pe=>{const he=K.value[n.selectedSpot].spot.find(Ce=>Ce.id===pe.idSpot).name,Me=pe.avgPsiValues??0;E[he][i]=Number(Me.toFixed(2))})});const g=Object.keys(E).map(T=>({name:T,type:"line",data:E[T],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(i){return i[0].value}},endLabel:{show:!0,formatter:function(i){return i.value},color:"#000",backgroundColor:"inherit",padding:5,borderRadius:5}}));C.value.setOption({xAxis:{data:N},series:g})},b=()=>{l.value=!1,r.value=0,I.value=[],clearInterval(S),G(r.value),z.value=r.value/n.initPlaybackData.length*100},ke=f=>{l.value=!1,I.value=[],r.value=parseInt(f.target.value,10),G(r.value),z.value=r.value/n.initPlaybackData.length*100};D(()=>n.initDateFilter,()=>{de()});const de=()=>{const f=V(n.initDateFilter),e=f.add(1,"days").format("YYYY-MM-DD"),g=f.subtract(2,"days").format("YYYY-MM-DD");j.value=e,d.value=g};de();const X=()=>{p.value=!0,b();const f=V(j.value).format("YYYY-MM-DD");v.value&&(l.value=!0),B.value=!0,h("onDateChange",f),setTimeout(()=>{p.value=!1},5e3)},Z=()=>{p.value=!0,b();const f=V(d.value).format("YYYY-MM-DD");v.value&&(l.value=!0),B.value=!0,h("onDateChange",f),setTimeout(()=>{p.value=!1},5e3)};D(()=>s.value,()=>{s.value&&(W(),x.value=!1,v.value=!1)}),D(()=>x.value,()=>{x.value?s.value=!1:s.value=!0}),D(()=>l.value,()=>{!l.value&&r.value==n.initPlaybackData.length&&(s.value?(b(),l.value=!0):(b(),l.value=!0,x.value&&(M.value=="forward"?F.value?(console.log(n.initDateFilter,Y.value),n.initDateFilter!=P.value?X():ee.value?(b(),h("onDateChange",Y.value)):W()):X():F.value?n.initDateFilter!=Y.value?Z():ee.value?(b(),h("onDateChange",P.value)):W():Z())))}),D(()=>[l.value,L.value],()=>{l.value?(S!=null&&clearInterval(S),S=setInterval(()=>{r.value<n.initPlaybackData.length?(r.value++,n.initPlaybackData[r.value]!=null&&(G(r.value),z.value=r.value/n.initPlaybackData.length*100)):(l.value=!1,clearInterval(S))},L.value)):S&&(clearInterval(S),S=null)}),D(()=>[m.asideVisible],()=>{setTimeout(()=>{C.value.resize()},1e3)});const H=a(!1),xe=()=>M.value=="forward"?j.value:d.value,U=a(!1),F=a(!1),ee=a(!0),Y=a(""),P=a(""),we=()=>{Y.value?P.value?(F.value=!0,s.value=!1,x.value=!0,v.value=!0,U.value=!1,l.value=!1):m.notifyShowError("Date 2 is required"):m.notifyShowError("Date 1 is required")};D(()=>U.value,()=>{U.value?(l.value=!1,F.value=!1):l.value=!0}),D(()=>[F.value],()=>{F.value&&(b(),M.value=="forward"?h("onDateChange",Y.value):h("onDateChange",P.value))}),D(()=>M.value,()=>{M.value=="backward"&&(b(),W())});const W=()=>{b(),console.log(n.initDateFilter),h("onDateChange",n.initDateFilter),F.value=!1,Y.value=null,P.value=null},De=f=>{(f.keyCode==80||f.keyCode==32)&&(l.value=!l.value),f.keyCode==37&&Z(),f.keyCode==39&&X()};return(f,e)=>{const g=se("font-awesome-icon"),T=se("center");return u(),y(ue,null,[U.value?(u(),y("div",Pe,[t("div",Te,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),o(J,{"in-label":"Speed","model-value":L.value,"onUpdate:modelValue":e[0]||(e[0]=i=>L.value=i)},{default:c(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),o(ae,{"in-type":"date","in-label":"Date 1","model-value":Y.value,"onUpdate:modelValue":e[1]||(e[1]=i=>Y.value=i)},null,8,["model-value"]),o(ae,{"in-type":"date","in-label":"Date 2","model-value":P.value,"onUpdate:modelValue":e[2]||(e[2]=i=>P.value=i)},null,8,["model-value"]),t("div",Ve,[o(R,{onClick:we,"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[16]||(e[16]=[w("Apply Filter")])),_:1}),o(R,{onClick:e[3]||(e[3]=i=>U.value=!U.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[17]||(e[17]=[w("Cancel")])),_:1})])])])):_("",!0),H.value?(u(),y("div",Re,[t("div",Ae,[e[22]||(e[22]=t("h2",null,[t("b",null,"Select Preference")],-1)),o(J,{"in-label":"Select","model-value":M.value,"onUpdate:modelValue":e[4]||(e[4]=i=>M.value=i)},{default:c(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),o(R,{onClick:e[5]||(e[5]=i=>H.value=!H.value),style:{width:"fit-content"},"bt-disabled":!1},{default:c(()=>[o(g,{icon:"save"}),e[21]||(e[21]=w(" Save & Apply"))]),_:1})])])):_("",!0),e[32]||(e[32]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),o(T,null,{default:c(()=>[o(J,{style:{width:"400px"},"in-label":"Speed","model-value":L.value,"onUpdate:modelValue":e[6]||(e[6]=i=>L.value=i)},{default:c(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Le,[t("div",Ue,[t("label",{class:O([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>s.value=i),type:"checkbox"},null,512),[[le,s.value]]),e[24]||(e[24]=w(" Auto-replay "))],2),t("label",{class:O([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>v.value=i),type:"checkbox"},null,512),[[le,v.value]]),e[25]||(e[25]=w(" Autoplay on navigating "))],2),t("label",{class:O([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>x.value=i),type:"checkbox"},null,512),[[le,x.value]]),e[26]||(e[26]=w(" Self Navigate "))],2),x.value?(u(),ie(R,{key:0,onClick:e[10]||(e[10]=i=>H.value=!H.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(g,{icon:"sliders"})]),_:1})):_("",!0)]),t("div",ze,[F.value?(u(),y("label",{key:0,class:O([`${k(m).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[w(A(k(V)(Y.value).format("ddd, DD MMM YY"))+"    ",1),o(g,{icon:M.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),w("    "+A(k(V)(P.value).format("ddd, DD MMM YY")),1)],2)):_("",!0),F.value?(u(),y("label",{key:1,class:O([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>ee.value=i),type:"checkbox"},null,512),[[le,ee.value]]),e[27]||(e[27]=w(" Repeat "))],2)):_("",!0),o(R,{onClick:e[12]||(e[12]=i=>U.value=!U.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(g,{icon:"calendar"})]),_:1}),Y.value&&P.value?(u(),ie(R,{key:2,onClick:W,"bt-disabled":!1,class:"slfnavbtn"},{default:c(()=>[o(g,{icon:"close"})]),_:1})):_("",!0)])]),t("div",Ie,[o(R,{"bt-disabled":p.value,onClick:Z},{default:c(()=>[o(g,{icon:"backward"}),w("    "+A(k(V)(d.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Ne,[t("b",{style:$e({color:`${k(m).accentColor}`})},A(k(V)(n.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),F.value?(u(),y("span",{key:0,class:O([`${k(m).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=w("Stops at: ")),t("b",null,A(k(V)(P.value).format("ddd, DD MMM YY")),1)],2)):(u(),y("span",Oe,[e[29]||(e[29]=w("Upcoming: ")),t("b",null,A(k(V)(xe()).format("ddd, DD MMM YY")),1)]))]),o(R,{"bt-disabled":p.value,onClick:X},{default:c(()=>[w(A(k(V)(j.value).format("ddd, DD MMM YY"))+"    ",1),o(g,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Be,[t("div",{ref_key:"heatMap",ref:$,style:{width:"100%",height:"600px"}},null,512),t("div",Ee,[t("div",je,[l.value?_("",!0):(u(),y("button",{key:0,onClick:e[13]||(e[13]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[o(g,{icon:"play"})])),l.value?(u(),y("button",{key:1,onClick:e[14]||(e[14]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[o(g,{icon:"pause"})])):_("",!0)]),t("div",qe,[t("input",{onChange:ke,type:"range",min:0,max:n.initPlaybackData.length,value:r.value,class:"slider"},null,40,Ge)]),t("div",null,[!l.value&&r.value==n.initPlaybackData.length?(u(),y("button",{key:0,onClick:b,class:"controlbtn",type:"button"},[o(g,{icon:"undo"})])):_("",!0)])]),B.value?(u(),y("div",Ke,e[31]||(e[31]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif"},null,-1)]))):_("",!0)])],64)}}}),We=ge(He,[["__scopeId","data-v-779d74c7"]]),Je={class:"row"},Qe={class:"col-md-3"},Xe=["value"],Ze={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},et={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},tt={class:"col-md-12",style:{position:"relative"}},lt={key:0,class:"loaders"},at=ye({__name:"PlaybackFol",setup(re){const oe=me(),Q=ce();Q.asideToggle(!1);const h=a(oe.getAllTrunk()),m=a("trunk1"),M=a();M.value=Object.keys(h.value);const x=a(5),n=a(),$=a([]),C=a(0),K=a([]),r=a(!1),z=a(!1),I=a(!1),B=()=>{C.value++,$.value.push(null)};be(()=>{L(),setTimeout(()=>{r.value=!0},1e3)}),D(()=>[n.value,x.value,m.value],async()=>{z.value=!0,await N()});const L=()=>{const d=new Date,s=d.getFullYear(),v=String(d.getMonth()+1).padStart(2,"0"),l=String(d.getDate()).padStart(2,"0"),p=`${s}-${v}-${l}`;n.value=p},S=async d=>new Promise(async(s,v)=>{try{const l=h.value[m.value];let p=[];for(let b=0;b<l.spot.length;b++)p.push(l.spot[b].id);const q={datefilter:d,timeFilter:x.value,idFilter:p},G=await _e.post(Fe.baseEnd+"api/History/getsplittedhistdata",q);s(G.data)}catch(l){v(l)}}),N=async()=>{try{I.value=!0;let s=[...await S(n.value)];if($.value.length>0){for(let v=0;v<$.value.length;v++){const l=$.value[v];if(l!==null){if(l.value!==n.value){const p=await S(l.value);s=s.concat(p)}}else console.log("Null")}z.value=!1}K.value=s,I.value=!1}catch(d){console.log(d),z.value=!1,I.value=!1}},E=(d,s)=>{$.value[s]=d,N()},ne=()=>{C.value>0&&(C.value--,$.value.pop()),N()},j=d=>{n.value=d};return(d,s)=>{const v=se("font-awesome-icon");return u(),ie(Se,{"context-title":"Playback"},{default:c(()=>[t("div",Je,[t("div",Qe,[o(J,{"in-label":"Select Line","model-value":m.value,"onUpdate:modelValue":s[0]||(s[0]=l=>m.value=l)},{default:c(()=>[(u(!0),y(ue,null,fe(M.value,(l,p)=>(u(),y("option",{key:p,value:l},A(h.value[l].name),9,Xe))),128))]),_:1},8,["model-value"]),o(J,{"in-label":"Time Range","model-value":x.value,"onUpdate:modelValue":s[1]||(s[1]=l=>x.value=l)},{default:c(()=>s[3]||(s[3]=[t("option",{value:"1"},"1 Menit",-1),t("option",{value:"2"},"2 Menit",-1),t("option",{value:"3"},"3 Menit",-1),t("option",{value:"4"},"4 Menit",-1),t("option",{value:"5"},"5 Menit",-1),t("option",{value:"10"},"10 Menit",-1),t("option",{value:"15"},"15 Menit",-1),t("option",{value:"30"},"30 Menit",-1),t("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),t("div",Ze,[o(ae,{"in-type":"date","in-label":"Date Filter","model-value":n.value,"onUpdate:modelValue":s[2]||(s[2]=l=>n.value=l),style:{width:"100%"}},null,8,["model-value"])]),t("div",et,[o(R,{onClick:ne,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(v,{icon:"minus"})]),_:1}),t("span",{class:O([`${k(Q).textTheme}`])},A(C.value),3),o(R,{onClick:B,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(v,{icon:"plus"})]),_:1})]),(u(!0),y(ue,null,fe(C.value,(l,p)=>(u(),y("div",{key:p,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[o(ae,{"in-type":"date","in-label":`Date Filter ${l}`,onOnValueChange:q=>E(q,p),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",tt,[I.value&&r.value?(u(),y("div",lt,s[4]||(s[4]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):_("",!0),o(We,{"init-date-filter":n.value,"selected-spot":m.value,"init-playback-data":K.value,onOnDateChange:j},null,8,["init-date-filter","selected-spot","init-playback-data"])])])]),_:1})}}}),ct=ge(at,[["__scopeId","data-v-33120dff"]]);export{ct as default};
