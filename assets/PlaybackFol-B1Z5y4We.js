import{u as me}from"./theme-B0435eda.js";import{_ as _e}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DR-yhLiA.js";import{_ as J}from"./SelectView.vue_vue_type_style_index_0_lang-CkJ0P28m.js";import{_ as oe}from"./InputView.vue_vue_type_style_index_0_lang-BRqQvvTG.js";import{_ as M}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-Db7qOyKe.js";import{t as ye}from"./trunk-BWplR3r4.js";import{a as $e}from"./axios-BimPEqV4.js";import{d as be,h as o,j as Pe,i as ge,k as h,r as ue,o as d,c as y,e as t,a,w as c,p as k,l as $,n as E,u as x,x as le,K as ae,b as re,t as L,f as Te,F as ne,_ as ke,y as fe,m as Ve}from"./index-M5Ua6xv2.js";import{i as Ae}from"./index-CehbAW_K.js";import{h as D}from"./moment-C5S46NFB.js";const ze={key:0,class:"datepickdialog"},Le={class:"datepickinner"},Re={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ue={key:1,class:"selfnavdialog"},Ie={class:"selfnavdialog-inner"},Oe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},je={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Ee={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Ne={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Be={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},qe={key:0,style:{"font-size":"11px"}},Ge={key:1,style:{"font-size":"11px"}},Ke={style:{position:"relative",width:"100%"}},He={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},We={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Je={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},Qe={style:{width:"100%",padding:"10px",position:"relative"}},Xe=["max","value"],Ze={key:0,class:"hmloader"},et=be({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange"],setup(de,{emit:se}){const Q=ye(),S=se,b=me(),C=o("forward"),w=o(!1),n=de,P=o(),p=o(),G=o(Q.getAllTrunk()),f=o(0),O=o(0),j=o([]),N=o(!1),R=o(250);let Y=null,B=null,K=[];const q={},ie=o(),m=o(""),u=o(""),v=o(!0),s=o(!1),l=o(!1),T=o(!1),X=()=>{p.value=Ae(P.value);const r={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};p.value.setOption(r),setTimeout(()=>{p.value.dispatchAction({type:"legendInverseSelect"}),p.value.dispatchAction({type:"legendAllSelect"})},100)};B=setInterval(()=>{p.value&&p.value&&p.value.resize()},1e3),Pe(()=>{clearInterval(B)}),ge(()=>{window.addEventListener("keyup",he)}),h(()=>P.value,()=>{X(),U(f.value)}),h(()=>n.initPlaybackData,()=>{F(),X(),N.value=!1,s.value&&(l.value=!0)});const U=r=>{K=[];for(let _ of G.value[n.selectedSpot].spot)q[_.name]=[];n.initPlaybackData.slice(0,r+1).forEach((_,i)=>{const pe=`${_.dateFilter} (${_.timeRange})`;K.push(pe),ie.value=pe,_.data.forEach(ce=>{const Ce=G.value[n.selectedSpot].spot.find(Fe=>Fe.id===ce.idSpot).name,Ye=ce.avgPsiValues??0;q[Ce][i]=Number(Ye.toFixed(2))})});const g=Object.keys(q).map(_=>({name:_,type:"line",data:q[_],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(i){return i[0].value}},endLabel:{show:!0,formatter:function(i){return i.value+" ; "+_},color:"#000",backgroundColor:"inherit",padding:5,fontSize:10,borderRadius:5}}));p.value.setOption({xAxis:{data:K},series:g})},F=()=>{l.value=!1,f.value=0,j.value=[],clearInterval(Y),U(f.value),O.value=f.value/n.initPlaybackData.length*100},xe=r=>{l.value=!1,j.value=[],f.value=parseInt(r.target.value,10),U(f.value),O.value=f.value/n.initPlaybackData.length*100};h(()=>n.initDateFilter,()=>{ve()});const ve=()=>{const r=D(n.initDateFilter),e=r.add(1,"days").format("YYYY-MM-DD"),g=r.subtract(2,"days").format("YYYY-MM-DD");m.value=e,u.value=g};ve();const Z=()=>{T.value=!0,F();const r=D(m.value).format("YYYY-MM-DD");s.value&&(l.value=!0),N.value=!0,S("onDateChange",r),setTimeout(()=>{T.value=!1},5e3)},ee=()=>{T.value=!0,F();const r=D(u.value).format("YYYY-MM-DD");s.value&&(l.value=!0),N.value=!0,S("onDateChange",r),setTimeout(()=>{T.value=!1},5e3)};h(()=>v.value,()=>{v.value&&(W(),w.value=!1,s.value=!1)}),h(()=>w.value,()=>{w.value?v.value=!1:v.value=!0}),h(()=>l.value,()=>{if(!l.value&&f.value==n.initPlaybackData.length)if(v.value)F(),l.value=!0;else{const r=D().format("YYYY-MM-DD"),e=D(n.initDateFilter).format("YYYY-MM-DD");r===e?l.value=!1:w.value?C.value=="forward"?V.value?(console.log(n.initDateFilter,A.value),n.initDateFilter!=z.value?Z():te.value?(F(),S("onDateChange",A.value)):W()):Z():V.value?n.initDateFilter!=A.value?ee():te.value?(F(),S("onDateChange",z.value)):W():ee():(F(),l.value=!0)}}),h(()=>[l.value,R.value],()=>{l.value?(Y!=null&&clearInterval(Y),Y=setInterval(()=>{f.value<n.initPlaybackData.length?(f.value++,n.initPlaybackData[f.value]!=null&&(U(f.value),O.value=f.value/n.initPlaybackData.length*100)):(l.value=!1,clearInterval(Y))},R.value)):Y&&(clearInterval(Y),Y=null)}),h(()=>[b.asideVisible],()=>{setTimeout(()=>{p.value.resize()},1e3)});const H=o(!1),we=()=>C.value=="forward"?m.value:u.value,I=o(!1),V=o(!1),te=o(!0),A=o(""),z=o(""),De=()=>{A.value?z.value?(V.value=!0,v.value=!1,w.value=!0,s.value=!0,I.value=!1,l.value=!1):b.notifyShowError("Date 2 is required"):b.notifyShowError("Date 1 is required")};h(()=>I.value,()=>{I.value?(l.value=!1,V.value=!1):l.value=!0}),h(()=>[V.value],()=>{V.value&&(F(),C.value=="forward"?S("onDateChange",A.value):S("onDateChange",z.value))}),h(()=>C.value,()=>{C.value=="backward"&&(F(),W())});const W=()=>{F(),console.log(n.initDateFilter),S("onDateChange",n.initDateFilter),V.value=!1,A.value=null,z.value=null},he=r=>{(r.keyCode==80||r.keyCode==32)&&(l.value=!l.value),r.keyCode==37&&ee(),r.keyCode==39&&Z()},Me=()=>{const r=p.value.getOption().legend[0].selected;Object.keys(r).forEach(e=>{p.value.dispatchAction({type:"legendUnSelect",name:e})})},Se=()=>{const r=p.value.getOption().legend[0].selected;Object.keys(r).forEach(e=>{p.value.dispatchAction({type:"legendSelect",name:e})})};return(r,e)=>{const g=ue("font-awesome-icon"),_=ue("center");return d(),y(ne,null,[I.value?(d(),y("div",ze,[t("div",Le,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),a(J,{"in-label":"Speed","model-value":R.value,"onUpdate:modelValue":e[0]||(e[0]=i=>R.value=i)},{default:c(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),a(oe,{"in-type":"date","in-label":"Date 1","model-value":A.value,"onUpdate:modelValue":e[1]||(e[1]=i=>A.value=i)},null,8,["model-value"]),a(oe,{"in-type":"date","in-label":"Date 2","model-value":z.value,"onUpdate:modelValue":e[2]||(e[2]=i=>z.value=i)},null,8,["model-value"]),t("div",Re,[a(M,{onClick:De,"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[16]||(e[16]=[k("Apply Filter")])),_:1}),a(M,{onClick:e[3]||(e[3]=i=>I.value=!I.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[17]||(e[17]=[k("Cancel ")])),_:1})])])])):$("",!0),H.value?(d(),y("div",Ue,[t("div",Ie,[e[22]||(e[22]=t("h2",null,[t("b",null,"Select Preference")],-1)),a(J,{"in-label":"Select","model-value":C.value,"onUpdate:modelValue":e[4]||(e[4]=i=>C.value=i)},{default:c(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),a(M,{onClick:e[5]||(e[5]=i=>H.value=!H.value),style:{width:"fit-content"},"bt-disabled":!1},{default:c(()=>[a(g,{icon:"save"}),e[21]||(e[21]=k(" Save & Apply"))]),_:1})])])):$("",!0),e[35]||(e[35]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),a(_,null,{default:c(()=>[a(J,{style:{width:"400px"},"in-label":"Speed","model-value":R.value,"onUpdate:modelValue":e[6]||(e[6]=i=>R.value=i)},{default:c(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Oe,[t("div",je,[t("label",{class:E([`${x(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>v.value=i),type:"checkbox"},null,512),[[ae,v.value]]),e[24]||(e[24]=k(" Auto-replay "))],2),t("label",{class:E([`${x(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>s.value=i),type:"checkbox"},null,512),[[ae,s.value]]),e[25]||(e[25]=k(" Autoplay on navigating "))],2),t("label",{class:E([`${x(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>w.value=i),type:"checkbox"},null,512),[[ae,w.value]]),e[26]||(e[26]=k(" Self Navigate "))],2),w.value?(d(),re(M,{key:0,onClick:e[10]||(e[10]=i=>H.value=!H.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[a(g,{icon:"sliders"})]),_:1})):$("",!0)]),t("div",Ee,[V.value?(d(),y("label",{key:0,class:E([`${x(b).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[k(L(x(D)(A.value).format("ddd, DD MMM YY"))+"    ",1),a(g,{icon:C.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),k("    "+L(x(D)(z.value).format("ddd, DD MMM YY")),1)],2)):$("",!0),V.value?(d(),y("label",{key:1,class:E([`${x(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>te.value=i),type:"checkbox"},null,512),[[ae,te.value]]),e[27]||(e[27]=k(" Repeat "))],2)):$("",!0),a(M,{onClick:e[12]||(e[12]=i=>I.value=!I.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[a(g,{icon:"calendar"})]),_:1}),A.value&&z.value?(d(),re(M,{key:2,onClick:W,"bt-disabled":!1,class:"slfnavbtn"},{default:c(()=>[a(g,{icon:"close"})]),_:1})):$("",!0)])]),t("div",Ne,[a(M,{"bt-disabled":T.value,onClick:ee},{default:c(()=>[a(g,{icon:"backward"}),k("    "+L(x(D)(u.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Be,[t("b",{style:Te({color:`${x(b).accentColor}`})},L(x(D)(n.initDateFilter).format("ddd, DD MMM YY")),5),e[31]||(e[31]=t("br",null,null,-1)),V.value?(d(),y("span",{key:0,class:E([`${x(b).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=k("Stops at: ")),t("b",null,L(x(D)(z.value).format("ddd, DD MMM YY")),1)],2)):(d(),y(ne,{key:1},[v.value?(d(),y("span",qe,[e[29]||(e[29]=k(" Repeating: ")),t("b",null,L(x(D)(n.initDateFilter).format("ddd, DD MMM YY")),1)])):(d(),y("span",Ge,[e[30]||(e[30]=k(" Upcoming: ")),t("b",null,L(x(D)(we()).format("ddd, DD MMM YY")),1)]))],64))]),a(M,{"bt-disabled":T.value,onClick:Z},{default:c(()=>[k(L(x(D)(m.value).format("ddd, DD MMM YY"))+"    ",1),a(g,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Ke,[t("div",He,[a(M,{"bt-size":"small",onClick:Se,"bt-disabled":!1},{default:c(()=>[a(g,{icon:"eye"}),e[32]||(e[32]=k(" Show All Legends"))]),_:1}),a(M,{"bt-size":"small",onClick:Me,"bt-disabled":!1},{default:c(()=>e[33]||(e[33]=[k("Clear Legends")])),_:1})]),t("div",{ref_key:"heatMap",ref:P,style:{width:"100%",height:"600px"}},null,512),t("div",We,[t("div",Je,[l.value?$("",!0):(d(),y("button",{key:0,style:{"z-index":"1",position:"relative"},onClick:e[13]||(e[13]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[a(g,{icon:"play"})])),l.value?(d(),y("button",{key:1,style:{"z-index":"1",position:"relative"},onClick:e[14]||(e[14]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[a(g,{icon:"pause"})])):$("",!0)]),t("div",Qe,[t("input",{onChange:xe,type:"range",min:0,max:n.initPlaybackData.length,value:f.value,class:"slider"},null,40,Xe)]),t("div",null,[!l.value&&f.value==n.initPlaybackData.length?(d(),y("button",{key:0,onClick:F,class:"controlbtn",type:"button"},[a(g,{icon:"undo"})])):$("",!0)])]),N.value?(d(),y("div",Ze,e[34]||(e[34]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif"},null,-1)]))):$("",!0)])],64)}}}),tt=ke(et,[["__scopeId","data-v-b843653a"]]),lt={class:"row"},at={class:"col-md-3"},ot=["value"],nt={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},st={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},it={class:"col-md-12",style:{position:"relative"}},ut={key:0,class:"loaders"},rt=be({__name:"PlaybackFol",setup(de){const se=ye(),Q=me();Q.asideToggle(!1);const S=o(se.getAllTrunk()),b=o("trunk1"),C=o();C.value=Object.keys(S.value);const w=o(5),n=o(),P=o([]),p=o(0),G=o([]),f=o(!1),O=o(!1),j=o(!1),N=()=>{p.value++,P.value.push(null)};ge(()=>{R(),setTimeout(()=>{f.value=!0},1e3)}),h(()=>[n.value,w.value,b.value],async()=>{O.value=!0,await B()});const R=()=>{const m=new Date,u=m.getFullYear(),v=String(m.getMonth()+1).padStart(2,"0"),s=String(m.getDate()).padStart(2,"0"),l=`${u}-${v}-${s}`;n.value=l},Y=async m=>new Promise(async(u,v)=>{try{const s=S.value[b.value];let l=[];for(let U=0;U<s.spot.length;U++)l.push(s.spot[U].id);const T={datefilter:m,timeFilter:w.value,idFilter:l},X=await $e.post(Ve.baseEnd+"api/History/getsplittedhistdata",T);u(X.data)}catch(s){v(s)}}),B=async()=>{try{j.value=!0;let u=[...await Y(n.value)];if(P.value.length>0){for(let v=0;v<P.value.length;v++){const s=P.value[v];if(s!==null){if(s.value!==n.value){const l=await Y(s.value);u=u.concat(l)}}else console.log("Null")}O.value=!1}G.value=u,j.value=!1}catch(m){console.log(m),O.value=!1,j.value=!1}},K=(m,u)=>{P.value[u]=m,B()},q=()=>{p.value>0&&(p.value--,P.value.pop()),B()},ie=m=>{n.value=m};return(m,u)=>{const v=ue("font-awesome-icon");return d(),re(_e,{"context-title":"Playback"},{default:c(()=>[t("div",lt,[t("div",at,[a(J,{"in-label":"Select Line","model-value":b.value,"onUpdate:modelValue":u[0]||(u[0]=s=>b.value=s)},{default:c(()=>[(d(!0),y(ne,null,fe(C.value,(s,l)=>(d(),y("option",{key:l,value:s},L(S.value[s].name),9,ot))),128))]),_:1},8,["model-value"]),a(J,{"in-label":"Time Range","model-value":w.value,"onUpdate:modelValue":u[1]||(u[1]=s=>w.value=s)},{default:c(()=>u[3]||(u[3]=[t("option",{value:"1"},"1 Menit",-1),t("option",{value:"2"},"2 Menit",-1),t("option",{value:"3"},"3 Menit",-1),t("option",{value:"4"},"4 Menit",-1),t("option",{value:"5"},"5 Menit",-1),t("option",{value:"10"},"10 Menit",-1),t("option",{value:"15"},"15 Menit",-1),t("option",{value:"30"},"30 Menit",-1),t("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),t("div",nt,[a(oe,{"in-type":"date","in-label":"Date Filter","model-value":n.value,"onUpdate:modelValue":u[2]||(u[2]=s=>n.value=s),style:{width:"100%"}},null,8,["model-value"])]),t("div",st,[a(M,{onClick:q,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[a(v,{icon:"minus"})]),_:1}),t("span",{class:E([`${x(Q).textTheme}`])},L(p.value),3),a(M,{onClick:N,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[a(v,{icon:"plus"})]),_:1})]),(d(!0),y(ne,null,fe(p.value,(s,l)=>(d(),y("div",{key:l,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[a(oe,{"in-type":"date","in-label":`Date Filter ${s}`,onOnValueChange:T=>K(T,l),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",it,[j.value&&f.value?(d(),y("div",ut,u[4]||(u[4]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):$("",!0),a(tt,{"init-date-filter":n.value,"selected-spot":b.value,"init-playback-data":G.value,onOnDateChange:ie},null,8,["init-date-filter","selected-spot","init-playback-data"])])])]),_:1})}}}),xt=ke(rt,[["__scopeId","data-v-7a2188c2"]]);export{xt as default};
