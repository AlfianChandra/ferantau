import{u as V}from"./theme-DoffrhoZ.js";import{i as G}from"./index-B5d4h4Xc.js";import{u as R}from"./http-Cz47y6o_.js";import{_ as H}from"./BatteryView.vue_vue_type_style_index_0_computed_true_lang-CVB2Y-RV.js";import{d as B,P as d,S as L,Q as N,R as W,c as F,f as w,u as $,a as A,e as r,I as j,t as E,n as Q,o as S,b as I,w as P,M as X,F as Y}from"./index-CDQFnZzk.js";import{_ as J}from"./InputView.vue_vue_type_style_index_0_lang-B5KEVRQq.js";import{_ as K}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DaUcP8qX.js";import{u as Z}from"./spotModel-ClvWpi9m.js";import{_ as ee}from"./SelectView.vue_vue_type_style_index_0_lang-BXPeyPUA.js";import"./moment-zH0z38ay.js";const te={style:{width:"200px",position:"relative",background:"#eee",height:"5px","border-radius":"10px"}},ae=B({__name:"ChartLineView",props:{ch_name:{type:String,required:!0},ch_spot:{type:[Number,String],required:!0},ch_filter_date:{type:String,required:!0},ch_ymax:{type:Number,default:300},ch_ymin:{type:Number,default:0},ch_timesplit:{type:Number,default:15}},setup(T){const a=V(),x=d(null),t=T,v=d(null),m=d(!0),c=d(0),o=d(null),u=d(!1),s=d([]),f={notMerge:!0,lazyUpdate:!0,tooltip:{trigger:"axis",axisPointer:{type:"cross"}},axisPointer:{link:{xAxisIndex:"all"},label:{backgroundColor:"#777"}},legend:{textStyle:{color:`${a.accentColor}`}},xAxis:{type:"category",axisSplitLine:{lineStyle:{color:"#cccccc11"}},name:"Time",nameLocation:"middle",nameGap:40,axisLabel:{rotate:-45,color:`${a.accentColor}`,interval:"auto"},boundaryGap:!1,axisTick:{alignWithLabel:!0}},yAxis:{name:"Pressure (PSI)",nameLocation:"middle",nameGap:50,min:t.ch_ymin,max:t.ch_ymax,splitLine:{lineStyle:{color:"#cccccc88"}},nameTextStyle:{verticalAlign:"middle"},axisTick:{show:!0,inside:!0},axisLabel:{color:`${a.accentColor}`},type:"value",axisLine:{show:!0}},series:[]};setTimeout(()=>{o.value.setOption(f)},500);const O=l=>new Date(l).toISOString(),D=async()=>{try{const l={id:t.ch_spot+"",date:O(t.ch_filter_date)},p=await R().httpPost("api/Data/getspotdata",l);c.value=80;const y=p.map(_=>{const b=_.timestamp.replace(".",":").split("T")[1],[i,n]=b.split(":");return`${i}:${n}`});s.value=y,c.value=85;const C=p.map(_=>parseFloat(_.psiValue).toFixed(2));f.xAxis=[{type:"category",data:y}],f.series=[{name:"Pressure",data:C,type:"line",itemStyle:{normal:{color:"#06B800",color0:"#FA0000",borderColor:null,borderColor0:null,opacity:0}},endLabel:{show:!0,fontSize:8,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:a.accentColorSecondary,formatter:function(_){const g=C;let b=0;for(let h=0;h<g.length;h++){let e=g[h];e>b&&(b=e)}let i=0,n=0;for(let h=0;h<g.length;h++){const e=parseInt(g[h]);(t.ch_spot==1&&e>=450&&e<=540||t.ch_spot==2&&e>=430&&e<=475||t.ch_spot==3&&e>=380&&e<=440||t.ch_spot==4&&e>=280&&e<=330||t.ch_spot==5&&e>=190&&e<=225||t.ch_spot==6&&e>=170&&e<=210||t.ch_spot==7&&e>=120&&e<=160||t.ch_spot==8&&e>=50&&e<=90||t.ch_spot==9&&e>=0&&e<=40)&&(i+=e,n++)}let M=0;const z=_.data,k=b;M=(k-z)/k*100;const U=i/n;return`Cur: ${parseFloat(_.data).toFixed(2)}
Avg: ${parseFloat(U).toFixed(2)}
Perc:${M.toFixed(2)}%`}},lineStyle:{color:"#007BFF",width:2}}],o.value.setOption(f),c.value=99,setTimeout(()=>{m.value=!1,c.value=0},1e3)}catch(l){console.log(l),m.value=!1}u.value=!0},q=()=>new Promise((l,p)=>{const y={toolbox:{iconStyle:{color:`${a.accentColor}`}},legend:{textStyle:{color:`${a.accentColor}`}},xAxis:{axisLabel:{rotate:-45,color:`${a.accentColor}`}},yAxis:{splitLine:{lineStyle:{color:"#cccccc11"}},axisLabel:{color:`${a.accentColor}`}}};try{o.value.setOption(y),l()}catch(C){p(C)}});return L(()=>[o.value,t.ch_filter_date],()=>{m.value=!0,c.value=0,setTimeout(()=>{o.value.setOption({series:[]}),c.value=12,D()},500),o.value.on("click",l=>{alert("!")})}),L(()=>t.ch_timesplit,()=>{if(t.ch_timesplit!=0){const l={xAxis:{axisLabel:{rotate:-45,color:`${a.accentColor}`,interval:p=>(s.value[p].split(":")[0],s.value[p].split(":")[1]%t.ch_timesplit===0)}}};o.value.setOption(l)}else{const l={xAxis:{axisLabel:{rotate:-45,color:`${a.accentColor}`,interval:"auto"}}};o.value.setOption(l),console.log(o.value.getOption().xAxis[0])}}),L(()=>[a.accentColor],async()=>{await q().then(()=>{})}),N(()=>{const l=G(v.value);o.value=l,x.value=setInterval(()=>{u.value&&D()},7e3)}),W(()=>{clearInterval(x.value),x.value=null}),(l,p)=>(S(),F("div",{class:"chparent",style:w({border:`1px solid ${$(a).accentColor}`})},[A(H,{"id-spot":t.ch_spot},null,8,["id-spot"]),r("h3",{style:w({color:`${$(a).accentColorSecondary}`})},E(t.ch_name),5),r("div",{ref_key:"chart",ref:v,style:{width:"100%",height:"400px"}},null,512),m.value?(S(),F("div",{key:0,class:Q(["chloader",[`${$(a).mTheme}`]])},[p[0]||(p[0]=r("img",{src:"https://i.pinimg.com/originals/cb/17/b8/cb17b80a942d7c317a35ff1324fae12f.gif"},null,-1)),r("div",te,[r("span",{style:w([{"border-radius":"10px",position:"absolute",top:"0",left:"0",height:"100%",transition:"ease-in-out 1s"},{width:`${c.value}%`,background:`${$(a).accentColor}`}])},null,4)])],2)):j("",!0)],4))}}),oe={class:"col-md-3"},le={class:"chartcontainer"},fe=B({__name:"LineChartFol",setup(T){const a=V(),x=Z();a.asideToggle(!1);const v=d((()=>{const o=new Date,u=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),f=String(o.getDate()).padStart(2,"0");return`${u}-${s}-${f}`})()),m=d({}),c=d(0);return N(async()=>{await x.getSpots().then(o=>{m.value=o})}),(o,u)=>(S(),I(K,{"context-title":"FOL | Line Chart"},{default:P(()=>[r("div",oe,[A(ee,{"in-label":"X-Axis Time Split","model-value":c.value,"onUpdate:modelValue":u[0]||(u[0]=s=>c.value=s)},{default:P(()=>u[2]||(u[2]=[r("option",{value:"0"},"Auto",-1),r("option",{value:"5"},"5 Minutes",-1),r("option",{value:"10"},"10 Minutes",-1),r("option",{value:"15"},"15 Minutes",-1),r("option",{value:"30"},"30 Minutes",-1),r("option",{value:"45"},"45 Minutes",-1),r("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"]),A(J,{"in-type":"date","in-label":"Date Filter","model-value":v.value,"onUpdate:modelValue":u[1]||(u[1]=s=>v.value=s)},null,8,["model-value"])]),r("div",le,[(S(!0),F(Y,null,X(Object.keys(m.value),s=>(S(),I(ae,{key:s,ch_timesplit:c.value,ch_name:m.value[s].name,ch_filter_date:v.value,ch_ymax:m.value[s].yMax,ch_spot:s},null,8,["ch_timesplit","ch_name","ch_filter_date","ch_ymax","ch_spot"]))),128))])]),_:1}))}});export{fe as default};
