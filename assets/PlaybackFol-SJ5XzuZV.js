import{u as me}from"./theme-DuAHQn8J.js";import{_ as Fe}from"./MainWrapperView.vue_vue_type_style_index_0_lang-59d3C1yq.js";import{_ as J}from"./SelectView.vue_vue_type_style_index_0_lang-DAWyShDP.js";import{_ as oe}from"./InputView.vue_vue_type_style_index_0_lang-B9J3lrU6.js";import{_ as h}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-DnaDrEZS.js";import{t as ye}from"./trunk-BWplR3r4.js";import{a as Ye}from"./axios-BimPEqV4.js";import{d as be,h as o,j as Pe,i as ge,k as D,r as ie,o as c,c as g,e as t,a,w as p,p as k,l as F,n as E,u as x,x as le,K as ae,b as ue,t as L,f as Te,F as re,_ as ke,y as fe,m as Ve}from"./index-pZoOXAy9.js";import{i as Ae}from"./index-CehbAW_K.js";import{h as z}from"./moment-C5S46NFB.js";const ze={key:0,class:"datepickdialog"},Le={class:"datepickinner"},Re={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ue={key:1,class:"selfnavdialog"},Ie={class:"selfnavdialog-inner"},Oe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},je={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Ee={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Ne={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Be={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},qe={key:1,style:{"font-size":"11px"}},Ge={style:{position:"relative",width:"100%"}},Ke={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},He={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},We={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},Je={style:{width:"100%",padding:"10px",position:"relative"}},Qe=["max","value"],Xe={key:0,class:"hmloader"},Ze=be({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange"],setup(de,{emit:ne}){const Q=ye(),S=ne,y=me(),M=o("forward"),w=o(!1),n=de,Y=o(),d=o(),G=o(Q.getAllTrunk()),f=o(0),O=o(0),j=o([]),N=o(!1),R=o(250);let C=null,B=null,K=[];const q={},se=o(),m=o(""),u=o(""),v=o(!0),s=o(!1),l=o(!1),P=o(!1),X=()=>{d.value=Ae(Y.value);const r={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};d.value.setOption(r),setTimeout(()=>{d.value.dispatchAction({type:"legendInverseSelect"}),d.value.dispatchAction({type:"legendAllSelect"})},100)};B=setInterval(()=>{d.value&&d.value&&d.value.resize()},1e3),Pe(()=>{clearInterval(B)}),ge(()=>{window.addEventListener("keyup",he)}),D(()=>Y.value,()=>{X(),U(f.value)}),D(()=>n.initPlaybackData,()=>{_(),X(),N.value=!1,s.value&&(l.value=!0)});const U=r=>{K=[];for(let $ of G.value[n.selectedSpot].spot)q[$.name]=[];n.initPlaybackData.slice(0,r+1).forEach(($,i)=>{const pe=`${$.dateFilter} (${$.timeRange})`;K.push(pe),se.value=pe,$.data.forEach(ce=>{const Ce=G.value[n.selectedSpot].spot.find($e=>$e.id===ce.idSpot).name,_e=ce.avgPsiValues??0;q[Ce][i]=Number(_e.toFixed(2))})});const b=Object.keys(q).map($=>({name:$,type:"line",data:q[$],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(i){return i[0].value}},endLabel:{show:!0,formatter:function(i){return i.value+" ; "+$},color:"#000",backgroundColor:"inherit",padding:5,fontSize:10,borderRadius:5}}));d.value.setOption({xAxis:{data:K},series:b})},_=()=>{l.value=!1,f.value=0,j.value=[],clearInterval(C),U(f.value),O.value=f.value/n.initPlaybackData.length*100},xe=r=>{l.value=!1,j.value=[],f.value=parseInt(r.target.value,10),U(f.value),O.value=f.value/n.initPlaybackData.length*100};D(()=>n.initDateFilter,()=>{ve()});const ve=()=>{const r=z(n.initDateFilter),e=r.add(1,"days").format("YYYY-MM-DD"),b=r.subtract(2,"days").format("YYYY-MM-DD");m.value=e,u.value=b};ve();const Z=()=>{P.value=!0,_();const r=z(m.value).format("YYYY-MM-DD");s.value&&(l.value=!0),N.value=!0,S("onDateChange",r),setTimeout(()=>{P.value=!1},5e3)},ee=()=>{P.value=!0,_();const r=z(u.value).format("YYYY-MM-DD");s.value&&(l.value=!0),N.value=!0,S("onDateChange",r),setTimeout(()=>{P.value=!1},5e3)};D(()=>v.value,()=>{v.value&&(W(),w.value=!1,s.value=!1)}),D(()=>w.value,()=>{w.value?v.value=!1:v.value=!0}),D(()=>l.value,()=>{!l.value&&f.value==n.initPlaybackData.length&&(v.value?(_(),l.value=!0):(_(),l.value=!0,w.value&&(M.value=="forward"?T.value?(console.log(n.initDateFilter,V.value),n.initDateFilter!=A.value?Z():te.value?(_(),S("onDateChange",V.value)):W()):Z():T.value?n.initDateFilter!=V.value?ee():te.value?(_(),S("onDateChange",A.value)):W():ee())))}),D(()=>[l.value,R.value],()=>{l.value?(C!=null&&clearInterval(C),C=setInterval(()=>{f.value<n.initPlaybackData.length?(f.value++,n.initPlaybackData[f.value]!=null&&(U(f.value),O.value=f.value/n.initPlaybackData.length*100)):(l.value=!1,clearInterval(C))},R.value)):C&&(clearInterval(C),C=null)}),D(()=>[y.asideVisible],()=>{setTimeout(()=>{d.value.resize()},1e3)});const H=o(!1),we=()=>M.value=="forward"?m.value:u.value,I=o(!1),T=o(!1),te=o(!0),V=o(""),A=o(""),De=()=>{V.value?A.value?(T.value=!0,v.value=!1,w.value=!0,s.value=!0,I.value=!1,l.value=!1):y.notifyShowError("Date 2 is required"):y.notifyShowError("Date 1 is required")};D(()=>I.value,()=>{I.value?(l.value=!1,T.value=!1):l.value=!0}),D(()=>[T.value],()=>{T.value&&(_(),M.value=="forward"?S("onDateChange",V.value):S("onDateChange",A.value))}),D(()=>M.value,()=>{M.value=="backward"&&(_(),W())});const W=()=>{_(),console.log(n.initDateFilter),S("onDateChange",n.initDateFilter),T.value=!1,V.value=null,A.value=null},he=r=>{(r.keyCode==80||r.keyCode==32)&&(l.value=!l.value),r.keyCode==37&&ee(),r.keyCode==39&&Z()},Se=()=>{const r=d.value.getOption().legend[0].selected;Object.keys(r).forEach(e=>{d.value.dispatchAction({type:"legendUnSelect",name:e})})},Me=()=>{const r=d.value.getOption().legend[0].selected;Object.keys(r).forEach(e=>{d.value.dispatchAction({type:"legendSelect",name:e})})};return(r,e)=>{const b=ie("font-awesome-icon"),$=ie("center");return c(),g(re,null,[I.value?(c(),g("div",ze,[t("div",Le,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),a(J,{"in-label":"Speed","model-value":R.value,"onUpdate:modelValue":e[0]||(e[0]=i=>R.value=i)},{default:p(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),a(oe,{"in-type":"date","in-label":"Date 1","model-value":V.value,"onUpdate:modelValue":e[1]||(e[1]=i=>V.value=i)},null,8,["model-value"]),a(oe,{"in-type":"date","in-label":"Date 2","model-value":A.value,"onUpdate:modelValue":e[2]||(e[2]=i=>A.value=i)},null,8,["model-value"]),t("div",Re,[a(h,{onClick:De,"bt-disabled":!1,style:{width:"fit-content"}},{default:p(()=>e[16]||(e[16]=[k("Apply Filter")])),_:1}),a(h,{onClick:e[3]||(e[3]=i=>I.value=!I.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:p(()=>e[17]||(e[17]=[k("Cancel")])),_:1})])])])):F("",!0),H.value?(c(),g("div",Ue,[t("div",Ie,[e[22]||(e[22]=t("h2",null,[t("b",null,"Select Preference")],-1)),a(J,{"in-label":"Select","model-value":M.value,"onUpdate:modelValue":e[4]||(e[4]=i=>M.value=i)},{default:p(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),a(h,{onClick:e[5]||(e[5]=i=>H.value=!H.value),style:{width:"fit-content"},"bt-disabled":!1},{default:p(()=>[a(b,{icon:"save"}),e[21]||(e[21]=k(" Save & Apply"))]),_:1})])])):F("",!0),e[34]||(e[34]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),a($,null,{default:p(()=>[a(J,{style:{width:"400px"},"in-label":"Speed","model-value":R.value,"onUpdate:modelValue":e[6]||(e[6]=i=>R.value=i)},{default:p(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Oe,[t("div",je,[t("label",{class:E([`${x(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>v.value=i),type:"checkbox"},null,512),[[ae,v.value]]),e[24]||(e[24]=k(" Auto-replay "))],2),t("label",{class:E([`${x(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>s.value=i),type:"checkbox"},null,512),[[ae,s.value]]),e[25]||(e[25]=k(" Autoplay on navigating "))],2),t("label",{class:E([`${x(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>w.value=i),type:"checkbox"},null,512),[[ae,w.value]]),e[26]||(e[26]=k(" Self Navigate "))],2),w.value?(c(),ue(h,{key:0,onClick:e[10]||(e[10]=i=>H.value=!H.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:p(()=>[a(b,{icon:"sliders"})]),_:1})):F("",!0)]),t("div",Ee,[T.value?(c(),g("label",{key:0,class:E([`${x(y).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[k(L(x(z)(V.value).format("ddd, DD MMM YY"))+"    ",1),a(b,{icon:M.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),k("    "+L(x(z)(A.value).format("ddd, DD MMM YY")),1)],2)):F("",!0),T.value?(c(),g("label",{key:1,class:E([`${x(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>te.value=i),type:"checkbox"},null,512),[[ae,te.value]]),e[27]||(e[27]=k(" Repeat "))],2)):F("",!0),a(h,{onClick:e[12]||(e[12]=i=>I.value=!I.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:p(()=>[a(b,{icon:"calendar"})]),_:1}),V.value&&A.value?(c(),ue(h,{key:2,onClick:W,"bt-disabled":!1,class:"slfnavbtn"},{default:p(()=>[a(b,{icon:"close"})]),_:1})):F("",!0)])]),t("div",Ne,[a(h,{"bt-disabled":P.value,onClick:ee},{default:p(()=>[a(b,{icon:"backward"}),k("    "+L(x(z)(u.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Be,[t("b",{style:Te({color:`${x(y).accentColor}`})},L(x(z)(n.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),T.value?(c(),g("span",{key:0,class:E([`${x(y).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=k("Stops at: ")),t("b",null,L(x(z)(A.value).format("ddd, DD MMM YY")),1)],2)):(c(),g("span",qe,[e[29]||(e[29]=k("Upcoming: ")),t("b",null,L(x(z)(we()).format("ddd, DD MMM YY")),1)]))]),a(h,{"bt-disabled":P.value,onClick:Z},{default:p(()=>[k(L(x(z)(m.value).format("ddd, DD MMM YY"))+"    ",1),a(b,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Ge,[t("div",Ke,[a(h,{"bt-size":"small",onClick:Me,"bt-disabled":!1},{default:p(()=>[a(b,{icon:"eye"}),e[31]||(e[31]=k(" Show All Legends"))]),_:1}),a(h,{"bt-size":"small",onClick:Se,"bt-disabled":!1},{default:p(()=>e[32]||(e[32]=[k("Clear Legends")])),_:1})]),t("div",{ref_key:"heatMap",ref:Y,style:{width:"100%",height:"600px"}},null,512),t("div",He,[t("div",We,[l.value?F("",!0):(c(),g("button",{key:0,style:{"z-index":"1",position:"relative"},onClick:e[13]||(e[13]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[a(b,{icon:"play"})])),l.value?(c(),g("button",{key:1,style:{"z-index":"1",position:"relative"},onClick:e[14]||(e[14]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[a(b,{icon:"pause"})])):F("",!0)]),t("div",Je,[t("input",{onChange:xe,type:"range",min:0,max:n.initPlaybackData.length,value:f.value,class:"slider"},null,40,Qe)]),t("div",null,[!l.value&&f.value==n.initPlaybackData.length?(c(),g("button",{key:0,onClick:_,class:"controlbtn",type:"button"},[a(b,{icon:"undo"})])):F("",!0)])]),N.value?(c(),g("div",Xe,e[33]||(e[33]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif"},null,-1)]))):F("",!0)])],64)}}}),et=ke(Ze,[["__scopeId","data-v-dc273ea9"]]),tt={class:"row"},lt={class:"col-md-3"},at=["value"],ot={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},nt={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},st={class:"col-md-12",style:{position:"relative"}},it={key:0,class:"loaders"},ut=be({__name:"PlaybackFol",setup(de){const ne=ye(),Q=me();Q.asideToggle(!1);const S=o(ne.getAllTrunk()),y=o("trunk1"),M=o();M.value=Object.keys(S.value);const w=o(5),n=o(),Y=o([]),d=o(0),G=o([]),f=o(!1),O=o(!1),j=o(!1),N=()=>{d.value++,Y.value.push(null)};ge(()=>{R(),setTimeout(()=>{f.value=!0},1e3)}),D(()=>[n.value,w.value,y.value],async()=>{O.value=!0,await B()});const R=()=>{const m=new Date,u=m.getFullYear(),v=String(m.getMonth()+1).padStart(2,"0"),s=String(m.getDate()).padStart(2,"0"),l=`${u}-${v}-${s}`;n.value=l},C=async m=>new Promise(async(u,v)=>{try{const s=S.value[y.value];let l=[];for(let U=0;U<s.spot.length;U++)l.push(s.spot[U].id);const P={datefilter:m,timeFilter:w.value,idFilter:l},X=await Ye.post(Ve.baseEnd+"api/History/getsplittedhistdata",P);u(X.data)}catch(s){v(s)}}),B=async()=>{try{j.value=!0;let u=[...await C(n.value)];if(Y.value.length>0){for(let v=0;v<Y.value.length;v++){const s=Y.value[v];if(s!==null){if(s.value!==n.value){const l=await C(s.value);u=u.concat(l)}}else console.log("Null")}O.value=!1}G.value=u,j.value=!1}catch(m){console.log(m),O.value=!1,j.value=!1}},K=(m,u)=>{Y.value[u]=m,B()},q=()=>{d.value>0&&(d.value--,Y.value.pop()),B()},se=m=>{n.value=m};return(m,u)=>{const v=ie("font-awesome-icon");return c(),ue(Fe,{"context-title":"Playback"},{default:p(()=>[t("div",tt,[t("div",lt,[a(J,{"in-label":"Select Line","model-value":y.value,"onUpdate:modelValue":u[0]||(u[0]=s=>y.value=s)},{default:p(()=>[(c(!0),g(re,null,fe(M.value,(s,l)=>(c(),g("option",{key:l,value:s},L(S.value[s].name),9,at))),128))]),_:1},8,["model-value"]),a(J,{"in-label":"Time Range","model-value":w.value,"onUpdate:modelValue":u[1]||(u[1]=s=>w.value=s)},{default:p(()=>u[3]||(u[3]=[t("option",{value:"1"},"1 Menit",-1),t("option",{value:"2"},"2 Menit",-1),t("option",{value:"3"},"3 Menit",-1),t("option",{value:"4"},"4 Menit",-1),t("option",{value:"5"},"5 Menit",-1),t("option",{value:"10"},"10 Menit",-1),t("option",{value:"15"},"15 Menit",-1),t("option",{value:"30"},"30 Menit",-1),t("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),t("div",ot,[a(oe,{"in-type":"date","in-label":"Date Filter","model-value":n.value,"onUpdate:modelValue":u[2]||(u[2]=s=>n.value=s),style:{width:"100%"}},null,8,["model-value"])]),t("div",nt,[a(h,{onClick:q,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:p(()=>[a(v,{icon:"minus"})]),_:1}),t("span",{class:E([`${x(Q).textTheme}`])},L(d.value),3),a(h,{onClick:N,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:p(()=>[a(v,{icon:"plus"})]),_:1})]),(c(!0),g(re,null,fe(d.value,(s,l)=>(c(),g("div",{key:l,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[a(oe,{"in-type":"date","in-label":`Date Filter ${s}`,onOnValueChange:P=>K(P,l),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",st,[j.value&&f.value?(c(),g("div",it,u[4]||(u[4]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):F("",!0),a(et,{"init-date-filter":n.value,"selected-spot":y.value,"init-playback-data":G.value,onOnDateChange:se},null,8,["init-date-filter","selected-spot","init-playback-data"])])])]),_:1})}}}),kt=ke(ut,[["__scopeId","data-v-7a2188c2"]]);export{kt as default};
