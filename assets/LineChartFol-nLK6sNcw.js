import{u as N}from"./theme-Dg3b8hyQ.js";import{i as H}from"./index-CehbAW_K.js";import{d as D,h as m,i as M,j,m as P,r as R,o as v,c as g,e as n,u as C,f as F,t as Y,a as L,p as W,k as A,n as X,l as G,b as V,w as B,y as Z,F as J}from"./index-CE7gz1ap.js";import{a as q}from"./axios-BimPEqV4.js";import{h as K}from"./moment-C5S46NFB.js";import{_ as Q}from"./InputView.vue_vue_type_style_index_0_lang-DapilM3p.js";import{_ as tt}from"./MainWrapperView.vue_vue_type_style_index_0_lang-C565Km9P.js";import{u as et}from"./spotModel-BrRZCDaP.js";import{_ as at}from"./SelectView.vue_vue_type_style_index_0_lang-CvGz5DOj.js";const ot="/assets/batt-OzIihCY1.png",st={class:"battery-container"},lt={key:0,class:"batimg"},nt=["src"],rt={class:"bt-parent"},it={class:"bt-perc"},ct={key:1,class:"batt-failed"},ut=D({__name:"BatteryView",props:{idSpot:{type:[Number,String],required:!0}},setup(w){const s=w,t=m({}),y=m(!1);M(async()=>{await i().then(l=>{t.value=l,h()})});const h=()=>{if(t.value!=null&&t.value.timestamp!=null){const l=K().format("YYYY-MM-DDTHH:MM:SS").split("T")[0],a=t.value.timestamp.split("T")[0];l==a&&(y.value=!0)}},c=setInterval(async()=>{await i().then(l=>{t.value=l})},6e4);j(()=>{clearInterval(c)});const i=async()=>new Promise(async(l,a)=>{try{const o={idspot:s.idSpot},x=await q.post(P.baseEnd+"api/Battery/getbatterylevel",o);l(x.data)}catch(o){a(o)}});return(l,a)=>{const o=R("font-awesome-icon");return v(),g("div",st,[t.value&&y.value?(v(),g("div",lt,[n("img",{src:C(ot),alt:"battery"},null,8,nt),n("div",rt,[n("span",{style:F({width:`${t.value.batt}%`}),class:"bt-child"},null,4),n("div",it,Y(t.value.batt)+"%",1)])])):(v(),g("span",ct,[n("b",null,[L(o,{icon:"exclamation-triangle"}),a[0]||(a[0]=W(" Battery reading failed"))])]))])}}}),pt={style:{width:"200px",position:"relative",background:"#eee",height:"5px","border-radius":"10px"}},dt=D({__name:"ChartLineView",props:{ch_name:{type:String,required:!0},ch_spot:{type:[Number,String],required:!0},ch_filter_date:{type:String,required:!0},ch_ymax:{type:Number,default:500},ch_ymin:{type:Number,default:0},ch_timesplit:{type:Number,default:15}},setup(w){const s=N(),t=w,y=m(null),h=m(!0),c=m(0),i=m(null),l=m(!1),a=m([]),o={notMerge:!0,lazyUpdate:!0,tooltip:{trigger:"axis",axisPointer:{type:"cross"}},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},dataView:{readOnly:!1},magicType:{type:["line","bar"]},restore:{},saveAsImage:{},brush:{type:["lineX","clear"]}},iconStyle:{color:`${s.accentColor}`}},axisPointer:{link:{xAxisIndex:"all"},label:{backgroundColor:"#777"}},legend:{textStyle:{color:`${s.accentColor}`}},xAxis:{type:"category",axisLabel:{rotate:-45,color:`${s.accentColor}`,interval:r=>(a.value[r].split(":")[0],a.value[r].split(":")[1]%t.ch_timesplit===0)},boundaryGap:!1,axisTick:{alignWithLabel:!0}},yAxis:{name:"Pressure (PSI)",min:t.ch_ymin,max:t.ch_ymax,splitLine:{lineStyle:{color:"#cccccc11"}},nameTextStyle:{verticalAlign:"middle"},axisTick:{show:!0,inside:!0},axisLabel:{color:`${s.accentColor}`},type:"value",axisLine:{show:!0}},series:[]};setTimeout(()=>{i.value.setOption(o)},500);const x=r=>new Date(r).toISOString(),k=async()=>{try{const r={id:t.ch_spot+"",date:x(t.ch_filter_date)},u=await q.post(P.baseEnd+"api/Data/getspotdata",r);c.value=80;const b=u.data.map(f=>{const $=f.timestamp.replace(".",":").split("T")[1],[p,d]=$.split(":");return`${p}:${d}`});a.value=b,c.value=85;const T=u.data.map(f=>parseFloat(f.psiValue).toFixed(2));o.xAxis=[{type:"category",data:b}],o.series=[{name:"Pressure",data:T,type:"line",itemStyle:{normal:{color:"#06B800",color0:"#FA0000",borderColor:null,borderColor0:null,opacity:0}},endLabel:{show:!0,fontSize:8,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:s.accentColorSecondary,formatter:function(f){const S=T;let $=0;for(let _=0;_<S.length;_++){let e=S[_];e>$&&($=e)}let p=0,d=0;for(let _=0;_<S.length;_++){const e=parseInt(S[_]);(t.ch_spot==1&&e>=128&&e<=550||t.ch_spot==2&&e>=0&&e<=600||t.ch_spot==3&&e>=0&&e<=600||t.ch_spot==4&&e>=0&&e<=600||t.ch_spot==5&&e>=0&&e<=600||t.ch_spot==6&&e>=0&&e<=600||t.ch_spot==7&&e>=0&&e<=600||t.ch_spot==8&&e>=0&&e<=600||t.ch_spot==9&&e>=0&&e<=600)&&(p+=e,d++)}let I=0;const U=f.data,O=$;I=(O-U)/O*100;const E=p/d;return`Cur: ${parseFloat(f.data).toFixed(2)}
Avg: ${parseFloat(E).toFixed(2)}
Perc:${I.toFixed(2)}%`}},lineStyle:{color:"#007BFF",width:2}}],i.value.setOption(o),c.value=99,setTimeout(()=>{h.value=!1,c.value=0},1e3)}catch(r){console.log(r),h.value=!1}l.value=!0},z=()=>new Promise((r,u)=>{const b={toolbox:{iconStyle:{color:`${s.accentColor}`}},legend:{textStyle:{color:`${s.accentColor}`}},xAxis:{axisLabel:{rotate:-45,color:`${s.accentColor}`}},yAxis:{splitLine:{lineStyle:{color:"#cccccc11"}},axisLabel:{color:`${s.accentColor}`}}};try{i.value.setOption(b),r()}catch(T){u(T)}});return A(()=>[i.value,t.ch_filter_date],()=>{h.value=!0,c.value=0,setTimeout(()=>{i.value.setOption({series:[]}),c.value=12,k()},500)}),A(()=>t.ch_timesplit,()=>{const r={xAxis:{axisLabel:{rotate:-45,color:`${s.accentColor}`,interval:u=>(a.value[u].split(":")[0],a.value[u].split(":")[1]%t.ch_timesplit===0)}}};i.value.setOption(r)}),A(()=>[s.accentColor],async()=>{await z().then(()=>{})}),setInterval(()=>{l.value&&k()},15e3),M(()=>{const r=H(y.value);i.value=r}),(r,u)=>(v(),g("div",{class:"chparent",style:F({border:`1px solid ${C(s).accentColor}`})},[L(ut,{"id-spot":t.ch_spot},null,8,["id-spot"]),n("h3",{style:F({color:`${C(s).accentColorSecondary}`})},Y(t.ch_name),5),n("div",{ref_key:"chart",ref:y,style:{width:"565px",height:"300px"}},null,512),h.value?(v(),g("div",{key:0,class:X(["chloader",[`${C(s).mTheme}`]])},[u[0]||(u[0]=n("img",{src:"https://i.pinimg.com/originals/cb/17/b8/cb17b80a942d7c317a35ff1324fae12f.gif"},null,-1)),n("div",pt,[n("span",{style:F([{"border-radius":"10px",position:"absolute",top:"0",left:"0",height:"100%",transition:"ease-in-out 1s"},{width:`${c.value}%`,background:`${C(s).accentColor}`}])},null,4)])],2)):G("",!0)],4))}}),mt={class:"col-md-3"},ht={class:"chartcontainer"},wt=D({__name:"LineChartFol",setup(w){const s=N(),t=et();s.asideToggle(!1);const h=m((()=>{const l=new Date,a=l.getFullYear(),o=String(l.getMonth()+1).padStart(2,"0"),x=String(l.getDate()).padStart(2,"0");return`${a}-${o}-${x}`})()),c=m({}),i=m(15);return M(async()=>{await t.getSpots().then(l=>{c.value=l})}),(l,a)=>(v(),V(tt,{"context-title":"FOL | Line Chart"},{default:B(()=>[n("div",mt,[L(at,{"in-label":"X-Axis Time Split","model-value":i.value,"onUpdate:modelValue":a[0]||(a[0]=o=>i.value=o)},{default:B(()=>a[2]||(a[2]=[n("option",{value:"5"},"5 Minutes",-1),n("option",{value:"10"},"10 Minutes",-1),n("option",{value:"15"},"15 Minutes",-1),n("option",{value:"30"},"30 Minutes",-1),n("option",{value:"45"},"45 Minutes",-1),n("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"]),L(Q,{"in-type":"date","in-label":"Date Filter","model-value":h.value,"onUpdate:modelValue":a[1]||(a[1]=o=>h.value=o)},null,8,["model-value"])]),n("div",ht,[(v(!0),g(J,null,Z(Object.keys(c.value),o=>(v(),V(dt,{key:o,ch_timesplit:i.value,ch_name:c.value[o].name,ch_filter_date:h.value,ch_spot:o},null,8,["ch_timesplit","ch_name","ch_filter_date","ch_spot"]))),128))])]),_:1}))}});export{wt as default};
