import{u as me}from"./theme-CXhRrftG.js";import{_ as _e}from"./MainWrapperView.vue_vue_type_style_index_0_lang-D9J4DR3l.js";import{_ as J}from"./SelectView.vue_vue_type_style_index_0_lang-D1Qw_yAt.js";import{_ as oe}from"./InputView.vue_vue_type_style_index_0_lang-DwS3iKGO.js";import{_ as z}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-CGbNGcfJ.js";import{t as ye}from"./trunk-BWplR3r4.js";import{a as $e}from"./axios-BimPEqV4.js";import{d as be,h as a,j as Fe,i as ge,k as D,r as ie,o as d,c as y,e as t,a as o,w as f,p as w,l as _,n as j,u as g,x as le,K as ae,b as ue,t as U,f as Ye,F as re,_ as xe,y as fe,m as Pe}from"./index-NkV-h5IJ.js";import{i as Ve}from"./index-CehbAW_K.js";import{h as R}from"./moment-C5S46NFB.js";const Te={key:0,class:"datepickdialog"},Re={class:"datepickinner"},ze={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ue={key:1,class:"selfnavdialog"},Ae={class:"selfnavdialog-inner"},Ie={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Le={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Ne={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Oe={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},je={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Be={key:1,style:{"font-size":"11px"}},Ee={style:{position:"relative",width:"100%"}},qe={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Ge={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},Ke={style:{width:"100%",padding:"10px",position:"relative"}},He=["max","value"],We={key:0,class:"hmloader"},Je=be({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange"],setup(de,{emit:ne}){const Q=ye(),h=ne,m=me(),M=a("forward"),x=a(!1),n=de,$=a(),k=a(),G=a(Q.getAllTrunk()),v=a(0),N=a(0),O=a([]),B=a(!1),A=a(250);let C=null,E=null,K=[];const q={},se=a(),p=a(""),u=a(""),r=a(!0),s=a(!1),l=a(!1),F=a(!1),X=()=>{k.value=Ve($.value);const c={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};k.value.setOption(c)};E=setInterval(()=>{k.value&&k.value&&k.value.resize()},1e3),Fe(()=>{clearInterval(E)}),ge(()=>{window.addEventListener("keyup",he)}),D(()=>$.value,()=>{X(),I(v.value)}),D(()=>n.initPlaybackData,()=>{S(),X(),B.value=!1,s.value&&(l.value=!0)});const I=c=>{K=[];for(let T of G.value[n.selectedSpot].spot)q[T.name]=[];n.initPlaybackData.slice(0,c+1).forEach((T,i)=>{const pe=`${T.dateFilter} (${T.timeRange})`;K.push(pe),se.value=pe,T.data.forEach(ce=>{const Me=G.value[n.selectedSpot].spot.find(Se=>Se.id===ce.idSpot).name,Ce=ce.avgPsiValues??0;q[Me][i]=Number(Ce.toFixed(2))})});const b=Object.keys(q).map(T=>({name:T,type:"line",data:q[T],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(i){return i[0].value}},endLabel:{show:!0,formatter:function(i){return i.value},color:"#000",backgroundColor:"inherit",padding:5,borderRadius:5}}));k.value.setOption({xAxis:{data:K},series:b})},S=()=>{l.value=!1,v.value=0,O.value=[],clearInterval(C),I(v.value),N.value=v.value/n.initPlaybackData.length*100},ke=c=>{l.value=!1,O.value=[],v.value=parseInt(c.target.value,10),I(v.value),N.value=v.value/n.initPlaybackData.length*100};D(()=>n.initDateFilter,()=>{ve()});const ve=()=>{const c=R(n.initDateFilter),e=c.add(1,"days").format("YYYY-MM-DD"),b=c.subtract(2,"days").format("YYYY-MM-DD");p.value=e,u.value=b};ve();const Z=()=>{F.value=!0,S();const c=R(p.value).format("YYYY-MM-DD");s.value&&(l.value=!0),B.value=!0,h("onDateChange",c),setTimeout(()=>{F.value=!1},5e3)},ee=()=>{F.value=!0,S();const c=R(u.value).format("YYYY-MM-DD");s.value&&(l.value=!0),B.value=!0,h("onDateChange",c),setTimeout(()=>{F.value=!1},5e3)};D(()=>r.value,()=>{r.value&&(W(),x.value=!1,s.value=!1)}),D(()=>x.value,()=>{x.value?r.value=!1:r.value=!0}),D(()=>l.value,()=>{!l.value&&v.value==n.initPlaybackData.length&&(r.value?(S(),l.value=!0):(S(),l.value=!0,x.value&&(M.value=="forward"?Y.value?(console.log(n.initDateFilter,P.value),n.initDateFilter!=V.value?Z():te.value?(S(),h("onDateChange",P.value)):W()):Z():Y.value?n.initDateFilter!=P.value?ee():te.value?(S(),h("onDateChange",V.value)):W():ee())))}),D(()=>[l.value,A.value],()=>{l.value?(C!=null&&clearInterval(C),C=setInterval(()=>{v.value<n.initPlaybackData.length?(v.value++,n.initPlaybackData[v.value]!=null&&(I(v.value),N.value=v.value/n.initPlaybackData.length*100)):(l.value=!1,clearInterval(C))},A.value)):C&&(clearInterval(C),C=null)}),D(()=>[m.asideVisible],()=>{setTimeout(()=>{k.value.resize()},1e3)});const H=a(!1),we=()=>M.value=="forward"?p.value:u.value,L=a(!1),Y=a(!1),te=a(!0),P=a(""),V=a(""),De=()=>{P.value?V.value?(Y.value=!0,r.value=!1,x.value=!0,s.value=!0,L.value=!1,l.value=!1):m.notifyShowError("Date 2 is required"):m.notifyShowError("Date 1 is required")};D(()=>L.value,()=>{L.value?(l.value=!1,Y.value=!1):l.value=!0}),D(()=>[Y.value],()=>{Y.value&&(S(),M.value=="forward"?h("onDateChange",P.value):h("onDateChange",V.value))}),D(()=>M.value,()=>{M.value=="backward"&&(S(),W())});const W=()=>{S(),console.log(n.initDateFilter),h("onDateChange",n.initDateFilter),Y.value=!1,P.value=null,V.value=null},he=c=>{(c.keyCode==80||c.keyCode==32)&&(l.value=!l.value),c.keyCode==37&&ee(),c.keyCode==39&&Z()};return(c,e)=>{const b=ie("font-awesome-icon"),T=ie("center");return d(),y(re,null,[L.value?(d(),y("div",Te,[t("div",Re,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),o(J,{"in-label":"Speed","model-value":A.value,"onUpdate:modelValue":e[0]||(e[0]=i=>A.value=i)},{default:f(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),o(oe,{"in-type":"date","in-label":"Date 1","model-value":P.value,"onUpdate:modelValue":e[1]||(e[1]=i=>P.value=i)},null,8,["model-value"]),o(oe,{"in-type":"date","in-label":"Date 2","model-value":V.value,"onUpdate:modelValue":e[2]||(e[2]=i=>V.value=i)},null,8,["model-value"]),t("div",ze,[o(z,{onClick:De,"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[16]||(e[16]=[w("Apply Filter")])),_:1}),o(z,{onClick:e[3]||(e[3]=i=>L.value=!L.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[17]||(e[17]=[w("Cancel")])),_:1})])])])):_("",!0),H.value?(d(),y("div",Ue,[t("div",Ae,[e[22]||(e[22]=t("h2",null,[t("b",null,"Select Preference")],-1)),o(J,{"in-label":"Select","model-value":M.value,"onUpdate:modelValue":e[4]||(e[4]=i=>M.value=i)},{default:f(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),o(z,{onClick:e[5]||(e[5]=i=>H.value=!H.value),style:{width:"fit-content"},"bt-disabled":!1},{default:f(()=>[o(b,{icon:"save"}),e[21]||(e[21]=w(" Save & Apply"))]),_:1})])])):_("",!0),e[32]||(e[32]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),o(T,null,{default:f(()=>[o(J,{style:{width:"400px"},"in-label":"Speed","model-value":A.value,"onUpdate:modelValue":e[6]||(e[6]=i=>A.value=i)},{default:f(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Ie,[t("div",Le,[t("label",{class:j([`${g(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>r.value=i),type:"checkbox"},null,512),[[ae,r.value]]),e[24]||(e[24]=w(" Auto-replay "))],2),t("label",{class:j([`${g(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>s.value=i),type:"checkbox"},null,512),[[ae,s.value]]),e[25]||(e[25]=w(" Autoplay on navigating "))],2),t("label",{class:j([`${g(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>x.value=i),type:"checkbox"},null,512),[[ae,x.value]]),e[26]||(e[26]=w(" Self Navigate "))],2),x.value?(d(),ue(z,{key:0,onClick:e[10]||(e[10]=i=>H.value=!H.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[o(b,{icon:"sliders"})]),_:1})):_("",!0)]),t("div",Ne,[Y.value?(d(),y("label",{key:0,class:j([`${g(m).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[w(U(g(R)(P.value).format("ddd, DD MMM YY"))+"    ",1),o(b,{icon:M.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),w("    "+U(g(R)(V.value).format("ddd, DD MMM YY")),1)],2)):_("",!0),Y.value?(d(),y("label",{key:1,class:j([`${g(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>te.value=i),type:"checkbox"},null,512),[[ae,te.value]]),e[27]||(e[27]=w(" Repeat "))],2)):_("",!0),o(z,{onClick:e[12]||(e[12]=i=>L.value=!L.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[o(b,{icon:"calendar"})]),_:1}),P.value&&V.value?(d(),ue(z,{key:2,onClick:W,"bt-disabled":!1,class:"slfnavbtn"},{default:f(()=>[o(b,{icon:"close"})]),_:1})):_("",!0)])]),t("div",Oe,[o(z,{"bt-disabled":F.value,onClick:ee},{default:f(()=>[o(b,{icon:"backward"}),w("    "+U(g(R)(u.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",je,[t("b",{style:Ye({color:`${g(m).accentColor}`})},U(g(R)(n.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),Y.value?(d(),y("span",{key:0,class:j([`${g(m).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=w("Stops at: ")),t("b",null,U(g(R)(V.value).format("ddd, DD MMM YY")),1)],2)):(d(),y("span",Be,[e[29]||(e[29]=w("Upcoming: ")),t("b",null,U(g(R)(we()).format("ddd, DD MMM YY")),1)]))]),o(z,{"bt-disabled":F.value,onClick:Z},{default:f(()=>[w(U(g(R)(p.value).format("ddd, DD MMM YY"))+"    ",1),o(b,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Ee,[t("div",{ref_key:"heatMap",ref:$,style:{width:"100%",height:"600px"}},null,512),t("div",qe,[t("div",Ge,[l.value?_("",!0):(d(),y("button",{key:0,style:{"z-index":"1",position:"relative"},onClick:e[13]||(e[13]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[o(b,{icon:"play"})])),l.value?(d(),y("button",{key:1,style:{"z-index":"1",position:"relative"},onClick:e[14]||(e[14]=i=>l.value=!l.value),class:"controlbtn",type:"button"},[o(b,{icon:"pause"})])):_("",!0)]),t("div",Ke,[t("input",{onChange:ke,type:"range",min:0,max:n.initPlaybackData.length,value:v.value,class:"slider"},null,40,He)]),t("div",null,[!l.value&&v.value==n.initPlaybackData.length?(d(),y("button",{key:0,onClick:S,class:"controlbtn",type:"button"},[o(b,{icon:"undo"})])):_("",!0)])]),B.value?(d(),y("div",We,e[31]||(e[31]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif"},null,-1)]))):_("",!0)])],64)}}}),Qe=xe(Je,[["__scopeId","data-v-6c8d48cf"]]),Xe={class:"row"},Ze={class:"col-md-3"},et=["value"],tt={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},lt={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},at={class:"col-md-12",style:{position:"relative"}},ot={key:0,class:"loaders"},nt=be({__name:"PlaybackFol",setup(de){const ne=ye(),Q=me();Q.asideToggle(!1);const h=a(ne.getAllTrunk()),m=a("trunk1"),M=a();M.value=Object.keys(h.value);const x=a(5),n=a(),$=a([]),k=a(0),G=a([]),v=a(!1),N=a(!1),O=a(!1),B=()=>{k.value++,$.value.push(null)};ge(()=>{A(),setTimeout(()=>{v.value=!0},1e3)}),D(()=>[n.value,x.value,m.value],async()=>{N.value=!0,await E()});const A=()=>{const p=new Date,u=p.getFullYear(),r=String(p.getMonth()+1).padStart(2,"0"),s=String(p.getDate()).padStart(2,"0"),l=`${u}-${r}-${s}`;n.value=l},C=async p=>new Promise(async(u,r)=>{try{const s=h.value[m.value];let l=[];for(let I=0;I<s.spot.length;I++)l.push(s.spot[I].id);const F={datefilter:p,timeFilter:x.value,idFilter:l},X=await $e.post(Pe.baseEnd+"api/History/getsplittedhistdata",F);u(X.data)}catch(s){r(s)}}),E=async()=>{try{O.value=!0;let u=[...await C(n.value)];if($.value.length>0){for(let r=0;r<$.value.length;r++){const s=$.value[r];if(s!==null){if(s.value!==n.value){const l=await C(s.value);u=u.concat(l)}}else console.log("Null")}N.value=!1}G.value=u,O.value=!1}catch(p){console.log(p),N.value=!1,O.value=!1}},K=(p,u)=>{$.value[u]=p,E()},q=()=>{k.value>0&&(k.value--,$.value.pop()),E()},se=p=>{n.value=p};return(p,u)=>{const r=ie("font-awesome-icon");return d(),ue(_e,{"context-title":"Playback"},{default:f(()=>[t("div",Xe,[t("div",Ze,[o(J,{"in-label":"Select Line","model-value":m.value,"onUpdate:modelValue":u[0]||(u[0]=s=>m.value=s)},{default:f(()=>[(d(!0),y(re,null,fe(M.value,(s,l)=>(d(),y("option",{key:l,value:s},U(h.value[s].name),9,et))),128))]),_:1},8,["model-value"]),o(J,{"in-label":"Time Range","model-value":x.value,"onUpdate:modelValue":u[1]||(u[1]=s=>x.value=s)},{default:f(()=>u[3]||(u[3]=[t("option",{value:"1"},"1 Menit",-1),t("option",{value:"2"},"2 Menit",-1),t("option",{value:"3"},"3 Menit",-1),t("option",{value:"4"},"4 Menit",-1),t("option",{value:"5"},"5 Menit",-1),t("option",{value:"10"},"10 Menit",-1),t("option",{value:"15"},"15 Menit",-1),t("option",{value:"30"},"30 Menit",-1),t("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),t("div",tt,[o(oe,{"in-type":"date","in-label":"Date Filter","model-value":n.value,"onUpdate:modelValue":u[2]||(u[2]=s=>n.value=s),style:{width:"100%"}},null,8,["model-value"])]),t("div",lt,[o(z,{onClick:q,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[o(r,{icon:"minus"})]),_:1}),t("span",{class:j([`${g(Q).textTheme}`])},U(k.value),3),o(z,{onClick:B,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[o(r,{icon:"plus"})]),_:1})]),(d(!0),y(re,null,fe(k.value,(s,l)=>(d(),y("div",{key:l,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[o(oe,{"in-type":"date","in-label":`Date Filter ${s}`,onOnValueChange:F=>K(F,l),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",at,[O.value&&v.value?(d(),y("div",ot,u[4]||(u[4]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):_("",!0),o(Qe,{"init-date-filter":n.value,"selected-spot":m.value,"init-playback-data":G.value,onOnDateChange:se},null,8,["init-date-filter","selected-spot","init-playback-data"])])])]),_:1})}}}),yt=xe(nt,[["__scopeId","data-v-7a2188c2"]]);export{yt as default};
