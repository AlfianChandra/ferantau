import{_ as J}from"./MainWrapperView.vue_vue_type_style_index_0_lang-C4R3sMlx.js";import{u as W}from"./theme-Bbv4sm2S.js";import{_ as X}from"./SelectView.vue_vue_type_style_index_0_lang-CrPtWUQ-.js";import{t as Z}from"./trunk-8aW8yjVA.js";import{u as C}from"./http-WjuO1N5T.js";import{i as N}from"./index-B5d4h4Xc.js";import{h as b}from"./moment-C5S46NFB.js";import{_ as ee}from"./InputView.vue_vue_type_style_index_0_lang-SuD45mof.js";import{d as E,N as o,O as G,P as Y,a6 as j,Q as U,c as y,e as t,t as i,a as p,r as H,R as f,u as z,w as R,o as m,_ as F,b as te,K as V,F as $}from"./index-B73MKg9L.js";const ae={class:"dev-wrapper"},se={class:"device-reading"},oe={style:{"margin-top":"1.5rem"},class:"info-sums"},le={style:{"text-align":"left"}},ne={style:{"padding-left":"5px"}},ie={key:0,style:{"text-align":"right"}},re={style:{color:"green","font-weight":"bold"}},ue={key:1,style:{"text-align":"right"}},de={style:{color:"orange","font-weight":"bold"}},ve={key:2,style:{"text-align":"right"}},ce={style:{color:"red","font-weight":"bold"}},pe={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},fe={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},me=E({__name:"DeviceInfo",props:{idSpot:{type:Object,required:!0},spotData:{type:Object,required:!0}},setup(M){const u=o(""),h=o(null),T=o(null),A=o(null),v=o(null),c=o({title:{text:"Battery Stats",subtext:"Battery percentage over time",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Battery Percentage","Pressure"],bottom:"0"},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{interval:60,rotate:45,formatter:function(a){return b(a).format("HH:mm")}},data:[]},{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(a){}},data:[]}],yAxis:[{name:"Pressure",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,max:300,axisLabel:{formatter:"{value}"}},{name:"Battery Percentage",nameLocation:"middle",nameGap:38,type:"value",position:"right",axisLine:{lineStyle:{color:"#8392A5"}},interval:10,max:100,axisLabel:{formatter:"{value}%"}}],series:[{name:"Pressure",data:[],type:"line",symbol:"none",smooth:!1,yAxisIndex:0,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-50,offset:[0,-20],formatter:function(a){return a.value+" PSI"}}},{name:"Battery Percentage",data:[],type:"line",smooth:!1,symbol:"none",yAxisIndex:1,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-30,offset:[0,-10],distacne:-5,formatter:function(a){return a.value+"%"}},itemStyle:{color:"#f00"}}]}),l=o({title:{text:"Device Response",subtext:"Device response over time (Higher is slower)",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Response Time"],bottom:"0"},xAxis:{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45},data:[]},yAxis:{name:"Response Time",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,axisLabel:{formatter:"{value}"}},series:[{name:"Response Time",data:[],type:"line",symbol:"none",smooth:!0,sampling:"average",endLabel:{fontSize:9,color:"inherit",show:!0,distance:0,offset:[0,-10],formatter:function(a){return a.value}}}]}),d=o({}),_=o(null),w=o(null),r=o(20),D=o(2),q=o(8),L=o(!1),I=o({time:[],response:[]}),P=M;G(()=>{B(),v.value=N(h.value),v.value.setOption(c.value),A.value=N(T.value),A.value.setOption(l.value),u.value=b().format("YYYY-MM-DD")}),window.addEventListener("resize",()=>{v.value&&v.value.resize()}),_.value=setInterval(()=>{B()},D.value*1e3),w.value=setInterval(()=>{O().then(a=>{k(a)}).catch(a=>{console.log(a)})},q.value*1e3);const B=async()=>new Promise(async(a,e)=>{try{const s={id:P.idSpot+""},g=await C().httpPost("api/Device/getdevicedata",s);d.value=g,I.value.time.push(b().format("HH:mm:ss")),I.value.response.push(n().diff),n().diffType=="hours"?(l.value.yAxis.axisLabel.formatter="{value} h",l.value.yAxis.interval=1):n().diffType=="minutes"?(l.value.yAxis.axisLabel.formatter="{value} m",l.value.yAxis.interval=5):(l.value.yAxis.axisLabel.formatter="{value} s",l.value.yAxis.interval=10),l.value.xAxis.data=I.value.time,l.value.series[0].data=I.value.response,A.value.setOption(l.value)}catch(s){e(s)}}),n=()=>{const a=b(d.value.time);let s=b().diff(a,"seconds");return s<0&&(s=0),s>0&&s<60?(L.value=!0,{active:s<r.value,diff:Math.floor(s/60),diffType:"minutes"}):s>3600?(L.value=!0,{active:s<r.value,diff:Math.floor(s/3600),diffType:"hours"}):(L.value=!0,{active:s<r.value,diff:s,diffType:"seconds"})};Y(()=>{clearInterval(_.value),clearInterval(w.value),_.value=null,w.value=null}),j(async()=>{v.value&&O().then(a=>{k(a)}).catch(a=>{console.log(a)})});const O=()=>new Promise(async(a,e)=>{try{const s={id:P.idSpot+"",date:u.value},g=await C().httpPost("api/Battery/getstats",s);a(g)}catch(s){e(s)}});U(()=>u.value,()=>{O().then(a=>{k(a)}).catch(a=>{console.log(a)})});const k=a=>{const e=a.battPayload,s=a.pressPayload,S=e.map(x=>x.timestamp),g=e.map(x=>x.batt),K=s.map(x=>x.pressureTime),Q=s.map(x=>x.pressure);c.value.xAxis[0].data=K,c.value.xAxis[1].data=S,c.value.series[0].data=Q,c.value.series[1].data=g,v.value.setOption(c.value)};return(a,e)=>{const s=H("font-awesome-icon"),S=H("center");return m(),y("div",ae,[t("h5",null,[t("b",null,i(P.spotData.name),1)]),e[13]||(e[13]=t("img",{src:"https://cdn-icons-png.flaticon.com/512/11330/11330463.png",style:{"margin-top":"1rem",width:"150px",height:"150px","object-fit":"cover","border-radius":"100px"}},null,-1)),t("div",se,[t("div",null,[t("label",null,[p(s,{icon:"gauge"})]),t("span",null,i(d.value.pressure)+" PSI",1)]),t("div",null,[t("label",null,[p(s,{icon:"car-battery"})]),t("span",null,i(d.value.battery)+"%",1)]),t("div",null,[t("label",null,[p(s,{icon:"wifi"})]),t("span",null,i(d.value.signal),1)])]),t("div",oe,[t("div",le,[e[2]||(e[2]=t("label",null,"Last Update ",-1)),t("span",ne,[f(i(z(b)(d.value.time).fromNow()),1),e[1]||(e[1]=t("br",null,null,-1)),f(i(z(b)(d.value.time).format("( ddd, DD MMM YY HH:mm:ss )")),1)])]),t("div",null,[n().active&&n().diff<10?(m(),y("div",ie,[p(s,{icon:"circle",style:{color:"green"}}),e[5]||(e[5]=f()),t("span",re,[e[3]||(e[3]=f("Device Active ")),e[4]||(e[4]=t("br",null,null,-1)),f("("+i(n().diff)+" "+i(n().diffType)+" response gap)",1)])])):n().active&&n().diff>=r.value/2?(m(),y("div",ue,[p(s,{icon:"circle",style:{color:"orange"}}),e[8]||(e[8]=f()),t("span",de,[e[6]||(e[6]=f("Device Active ")),e[7]||(e[7]=t("br",null,null,-1)),f("("+i(n().diff)+" "+i(n().diffType)+" response gap - slow)",1)])])):(m(),y("div",ve,[p(s,{icon:"circle",style:{color:"red"}}),e[9]||(e[9]=f()),t("span",ce,"Trouble reading... ("+i(n().diff)+" "+i(n().diffType)+")",1)]))])]),t("div",pe,[e[10]||(e[10]=t("hr",null,null,-1)),p(S,null,{default:R(()=>[p(ee,{"model-value":u.value,"onUpdate:modelValue":e[0]||(e[0]=g=>u.value=g),style:{width:"200px"},"in-label":"Date","in-type":"date"},null,8,["model-value"])]),_:1}),e[11]||(e[11]=t("hr",null,null,-1)),t("div",{ref_key:"batChart",ref:h,style:{width:"100%",height:"500px"}},null,512)]),t("div",fe,[e[12]||(e[12]=t("hr",null,null,-1)),t("div",{ref_key:"devResponseChart",ref:T,style:{width:"100%",height:"350px"}},null,512)])])}}}),ye=F(me,[["__scopeId","data-v-2ab7de8e"]]),ge={class:"col-md-3"},xe=["value"],be={class:"device-display"},he=E({__name:"DeviceMonitoring",setup(M){const u=o(null),h=o(!1),T=o(1e3),A=W(),v=o(Z().getAllTrunk()),c=o("trunk1"),l=o(Object.keys(v.value)),d=o([]);return A.asideToggle(!0),G(()=>{h.value=!0}),U(()=>h.value,_=>{_?(console.log("MONITORING STARTED"),u.value=setInterval(()=>{},T.value)):(console.log("MONITORING STOPPED"),clearInterval(u.value))}),Y(()=>{h.value=!1,u.value&&(clearInterval(u.value),u.value=null),console.log("MONITORING STOPPED")}),j(()=>{l.value&&(d.value=v.value[c.value].spot,console.log(d.value))}),(_,w)=>(m(),te(J,{"context-title":"Device Monitoring"},{default:R(()=>[t("div",ge,[p(X,{"in-label":"Installed Device","model-value":c.value,"onUpdate:modelValue":w[0]||(w[0]=r=>c.value=r)},{default:R(()=>[(m(!0),y($,null,V(l.value,(r,D)=>(m(),y("option",{key:D,value:r},i(v.value[r].name),9,xe))),128))]),_:1},8,["model-value"])]),t("div",be,[(m(!0),y($,null,V(d.value,(r,D)=>(m(),y("div",{class:"device-items",key:D},[p(ye,{idSpot:r.id,"spot-data":r},null,8,["idSpot","spot-data"])]))),128))])]),_:1}))}}),Oe=F(he,[["__scopeId","data-v-529d9729"]]);export{Oe as default};
