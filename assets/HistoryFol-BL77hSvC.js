import{_ as oe}from"./InputView.vue_vue_type_style_index_0_lang-BRqQvvTG.js";import{_ as se}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DR-yhLiA.js";import{u as ne}from"./theme-B0435eda.js";import{i as I}from"./index-CehbAW_K.js";import{_ as ie}from"./SelectView.vue_vue_type_style_index_0_lang-CkJ0P28m.js";import{u as re}from"./spotModel-BXJEMVPW.js";import{_ as ce}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-Db7qOyKe.js";import{a as de}from"./axios-BimPEqV4.js";import{d as ue,h as p,i as G,k as H,B as pe,r as me,o as c,c as d,a as v,w as A,e as l,n as y,u as r,f,F as h,y as _,l as fe,m as he,t as w,p as F}from"./index-M5Ua6xv2.js";import{_ as U}from"./CheckboxView.vue_vue_type_style_index_0_computed_true_lang-Dft3NqXX.js";const ve={class:"col-md-3"},ye={class:"col-md-12"},xe={class:"table-responsive"},ge={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end",gap:"1rem"}},be={style:{display:"flex","flex-flow":"row wrap","justify-content":"flex-end","align-items":"center",gap:"0.5rem","margin-bottom":"1rem",border:"1px solid #ccc",width:"fit-content",padding:"10px","border-radius":"100px"}},_e={style:{display:"flex","flex-flow":"row nowrap","align-items":"center"}},we={style:{display:"flex","flex-flow":"row nowrap","align-items":"center"}},Ce={class:"tbl"},ke={class:"theads"},Se={style:{display:"flex","flex-flow":"column"}},$e={key:1,style:{color:"#ccc"}},Te={style:{display:"flex","flex-flow":"row nowrap"}},Ve={style:{width:"50%",display:"flex","flex-flow":"column"}},De={style:{width:"50%",display:"flex","flex-flow":"column"}},Ae={class:"table-responsive"},Fe={class:"tbl2"},Ge=ue({__name:"HistoryFol",setup(Oe){const K=re(),O=p(null),B=p(null),V=p({}),g=p([]),M=p([]);G(async()=>{await K.fetchSpots().then(o=>{V.value=o,Object.keys(V).forEach(t=>{M.value.push(V[t].name)})})});const i=ne(),S=p(60),C=p(),b=p([]),D=p(!1);i.asideToggle(!1);const W=()=>{const o=new Date,t=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0"),a=`${t}-${s}-${e}`;C.value=a};H(()=>[C.value,S.value],async()=>{b.value=[],u.value=[],x.value=null,await P().then(o=>{b.value=o}).catch(o=>{})});const P=async()=>new Promise(async(o,t)=>{try{const s={datefilter:C.value,timeFilter:S.value},e=await de.post(he.baseEnd+"api/History/gethistdata",s);o(e.data)}catch(s){t(s)}}),N=p({});function J(o){const t={};return o.forEach(s=>{s.data.forEach(e=>{const{idSpot:a,avgPsiValues:n}=e;t[a]?(n>t[a].maxValue&&(t[a].maxValue=n),n<t[a].minValue&&(t[a].minValue=n)):t[a]={maxValue:n,minValue:n}})}),N.value=t,N.value}const Y=pe(()=>J(b.value));function q(o,t){const s=Y.value;if(!s[t])return"";const e=o.data.find(a=>a.idSpot===t);if(e){if(e.avgPsiValues===s[t].maxValue)return"highest-value";if(e.avgPsiValues===s[t].minValue)return"lowest-value"}return""}const u=p({});let j=null;const x=p(null);H(()=>u.value,()=>{j=Object.keys(u.value)});const R=(o,t,s)=>{const e=t.timeRange,a=t.type,n=t.rangeData;o?(u.value[e+"."+a]={timerange:e,type:a,checkbox:s,data:n},a==="normal"&&(x.value=e+"."+a)):(delete u.value[e+"."+a],a==="normal"&&x.value===e+"."+a&&(x.value=null)),u.value=Q(u.value),$()},Q=o=>{const t=Object.entries(o);return t.sort((e,a)=>e[1].type==="normal"&&a[1].type!=="normal"?-1:e[1].type!=="normal"&&a[1].type==="normal"?1:0),Object.fromEntries(t)},X=o=>o.type==="normal"?x.value!==null&&x.value!==o.timeRange+"."+o.type:!1,$=()=>{Object.keys(u.value).length>0?(D.value=!0,setTimeout(()=>{te()},500)):D.value=!1},Z=async()=>{b.value=[],E(),$(),await P().then(o=>{b.value=o}).catch(o=>{})},ee=()=>{E(),$()},E=()=>{Object.keys(u.value).forEach(o=>{const t=u.value[o].checkbox;t.checked=!1}),x.value=null,u.value={},$()},T=p(),L=p(),te=()=>{if(Object.keys(u.value).length>0){const o=I(O.value),t=I(B.value);T.value=o,L.value=t,le()}else T.value=null,L.value=null},ae=async o=>{const t=o.map((a,n)=>{const m=a.map(k=>Number(k)||0);return n==0?(console.log(m),{name:"Normal",type:"line",data:m,xAxisIndex:0,yAxisIndex:0}):(console.log(m),{name:"Drop "+n,type:"line",data:m,xAxisIndex:0,yAxisIndex:0})}),s=await Promise.all(t);s.sort((a,n)=>a.name==="Normal"?-1:n.name==="Normal"?1:0);const e={notMerge:!0,lazyUpdate:!0,tooltip:{trigger:"item",axisPointer:{type:"cross"}},grid:{left:"10%",right:"10%",bottom:"10%",containLabel:!0},legend:{data:s.map(a=>a.name)},xAxis:{type:"category",data:M.value,nameLocation:"start",boundaryGap:!1,axisTick:{alignWithLabel:!0}},yAxis:{name:"Pressure (PSI)",nameTextStyle:{verticalAlign:"middle"},axisTick:{show:!0,inside:!0},type:"value",axisLine:{show:!0}},series:s};T.value.setOption(e)},le=()=>{if(T.value){let o=[];Object.keys(u.value).forEach(t=>{const s=u.value[t].data;let e=[],a=[];for(let n=0;n<s.length;n++){const m=s[n].idSpot;m==1&&e.push(parseFloat(s[n].avgPsiValues).toFixed(2)),m==2&&e.push(parseFloat(s[n].avgPsiValues).toFixed(2)),m==3&&a.push(parseFloat(s[n].avgPsiValues).toFixed(2)),m==4&&a.push(parseFloat(s[n].avgPsiValues).toFixed(2))}o.push(e)}),ae(o)}};G(()=>{W()});const z=(o,t)=>{const e=u.value[o].data;for(let a=0;a<e.length;a++)if(e[a].idSpot==t)return e[a].avgPsiValues.toFixed(2)};return(o,t)=>{const s=me("font-awesome-icon");return c(),d(h,null,[v(se,{"context-title":"FOL | History Data"},{default:A(()=>[l("div",ve,[v(ie,{"in-label":"Time Range","model-value":S.value,"onUpdate:modelValue":t[0]||(t[0]=e=>S.value=e)},{default:A(()=>t[2]||(t[2]=[l("option",{value:"1"},"1 Menit",-1),l("option",{value:"2"},"2 Menit",-1),l("option",{value:"3"},"3 Menit",-1),l("option",{value:"4"},"4 Menit",-1),l("option",{value:"5"},"5 Menit",-1),l("option",{value:"15"},"15 Menit",-1),l("option",{value:"30"},"30 Menit",-1),l("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),v(oe,{"in-type":"date","in-label":"Date Filter","model-value":C.value,"onUpdate:modelValue":t[1]||(t[1]=e=>C.value=e)},null,8,["model-value"])]),l("div",ye,[l("div",xe,[l("div",ge,[l("div",be,[l("div",_e,[t[3]||(t[3]=l("div",{style:{"background-color":"green",width:"20px",height:"20px","border-radius":"100px"}},null,-1)),l("span",{class:y([`${r(i).textTheme}`]),style:{"margin-left":"0.2rem","font-size":"12px","font-weight":"bold"}},"Nilai Tertinggi",2)]),l("div",we,[t[4]||(t[4]=l("div",{style:{"background-color":"red",width:"20px",height:"20px","border-radius":"100px"}},null,-1)),l("span",{class:y([`${r(i).textTheme}`]),style:{"margin-left":"0.2rem","font-size":"12px","font-weight":"bold"}},"Nilai Terendah",2)])]),v(ce,{onClick:Z,"bt-disabled":!1,"bt-type":"button","bt-size":"small",style:{height:"42px",width:"42px","border-radius":"100px",display:"flex","flex-flow":"row nowrap","align-items":"center"}},{default:A(()=>[v(s,{icon:"refresh"})]),_:1})]),l("table",Ce,[l("thead",ke,[l("tr",{style:{padding:"20px"},class:y([`${r(i).textTheme}`])},[l("th",{style:f({border:`1px solid ${r(i).accentColor}`})},[v(s,{icon:"check-double"})],4),l("th",{style:f({border:`1px solid ${r(i).accentColor}`})},"Interval",4),(c(!0),d(h,null,_(g.value,(e,a)=>(c(),d("th",{style:f({border:`1px solid ${r(i).accentColor}`}),key:a},w(g.value[a].spot),5))),128))],2)]),l("tbody",null,[(c(!0),d(h,null,_(b.value,(e,a)=>(c(),d("tr",{key:a},[l("td",{style:f({border:`1px solid ${r(i).accentColor}`}),class:y([`${r(i).textTheme}`])},[l("div",Se,[v(U,{cb_disabled:X({timeRange:e.timeRange,type:"normal"}),cb_data:{timeRange:e.timeRange,type:"normal",rangeData:e.data},onOnCheckBoxChange:R,cb_label:"Normal"},null,8,["cb_disabled","cb_data"]),v(U,{cb_disabled:!1,cb_checked:!1,cb_data:{timeRange:e.timeRange,type:"drop",rangeData:e.data},onOnCheckBoxChange:R,cb_label:"Drop"},null,8,["cb_data"])])],6),l("td",{style:f({border:`1px solid ${r(i).accentColor}`}),class:y([`${r(i).textTheme}`])},w(e.timeRange),7),(c(!0),d(h,null,_(g.value,(n,m)=>(c(),d("td",{style:f({border:`1px solid ${r(i).accentColor}`,position:"relative"}),key:m,class:y([`${q(e,n.id)}`,`${r(i).textTheme}`])},[e.data.find(k=>k.idSpot===n.id)?(c(),d(h,{key:0},[F(w(e.data.find(k=>k.idSpot===n.id).avgPsiValues.toFixed(2)),1)],64)):(c(),d("span",$e,"N/A"))],6))),128))]))),128))])])])])]),_:1}),D.value?(c(),d("div",{key:0,class:y(["chart-container",[`${r(i).mTheme}`]])},[l("button",{onClick:ee,class:"chc-dismiss",style:f({color:`${r(i).accentColor}`})},[v(s,{icon:"close"})],4),l("div",Te,[l("div",Ve,[l("h4",{style:f([{color:`${r(i).accentColor}`},{"text-align":"center","font-weight":"bold"}])}," MGS BJG - BOOSTER ",4),l("div",{ref_key:"eChartsA",ref:O,style:{width:"100%",height:"300px",position:"relative"}},null,512)]),l("div",De,[l("h4",{style:f([{color:`${r(i).accentColor}`},{"text-align":"center","font-weight":"bold"}])}," MGS KAS - MOS TPN ",4),l("div",{ref_key:"eChartsB",ref:B,style:{width:"100%",height:"300px",position:"relative"}},null,512)])]),l("div",Ae,[l("table",Fe,[l("thead",null,[l("tr",{style:{padding:"5px"},class:y([`${r(i).textTheme}`])},[l("th",{style:f({border:`1px solid ${r(i).accentColor}`})},null,4),(c(!0),d(h,null,_(g.value,(e,a)=>(c(),d("th",{style:f({border:`1px solid ${r(i).accentColor}`}),key:a},w(g.value[a].spot),5))),128))],2)]),l("tbody",null,[(c(!0),d(h,null,_(r(j),(e,a)=>(c(),d("tr",{key:a},[l("td",{style:f({border:`1px solid ${r(i).accentColor}`,position:"relative",textTransform:"uppercase",fontWeight:"bold"})},w(u.value[e].timerange+`
`+u.value[e].type),5),(c(!0),d(h,null,_(g.value,(n,m)=>(c(),d("td",{style:f({border:`1px solid ${r(i).accentColor}`}),key:m},[z(e,n.id)?(c(),d(h,{key:0},[F(w(z(e,n.id)),1)],64)):(c(),d(h,{key:1},[F("0.00")],64))],4))),128))]))),128))])])])],2)):fe("",!0)],64)}}});export{Ge as default};
