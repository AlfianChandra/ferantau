import{u as be}from"./theme-CBoiNPac.js";import{_ as Pe}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DLZWwpUa.js";import{_ as X}from"./SelectView.vue_vue_type_style_index_0_lang-CAc9hrd3.js";import{_ as ie}from"./InputView.vue_vue_type_style_index_0_lang-BLS72ctc.js";import{_ as S}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-B3HWKD_d.js";import{t as ge}from"./trunk-BWplR3r4.js";import{a as Te}from"./axios-BimPEqV4.js";import{d as ke,h as l,j as Ve,i as xe,k as M,r as re,o as d,c as v,e as t,a,w as f,p as g,l as P,n as j,u as k,x as ne,K as se,b as de,t as L,f as Ae,F as Z,_ as De,y as me,m as ze}from"./index-Bhh4itYC.js";import{i as Le}from"./index-CehbAW_K.js";import{h as w}from"./moment-C5S46NFB.js";const Re={key:0,class:"datepickdialog"},Ue={class:"datepickinner"},Ie={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ee={key:1,class:"selfnavdialog"},Oe={class:"selfnavdialog-inner"},je={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ne={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Be={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},qe={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Ge={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Ke={key:0,style:{"font-size":"11px"}},He={key:0,style:{"font-size":"11px"}},We={key:1,style:{"font-size":"11px"}},Je={style:{position:"relative",width:"100%"}},Qe={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},Xe={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Ze={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},et={style:{width:"100%",padding:"10px",position:"relative"}},tt=["max","value"],lt={key:0,class:"hmloader"},at=ke({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange"],setup(ve,{emit:ue}){const ee=ge(),Y=ue,m=be(),C=l("forward"),h=l(!1),o=ve,T=l(),p=l(),H=l(ee.getAllTrunk()),y=l(0),E=l(0),O=l([]),N=l(!1),R=l(250);let _=null,B=null;const q=l(!1);let W=[];const G={},x=l(),r=l(""),D=l(""),n=l(!0),c=l(!1),s=l(!1),U=l(!1),K=()=>{p.value=Le(T.value);const u={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};p.value.setOption(u),setTimeout(()=>{p.value.dispatchAction({type:"legendInverseSelect"}),p.value.dispatchAction({type:"legendAllSelect"})},100)},pe=()=>{const u=w().format("YYYY-MM-DD"),e=w(o.initDateFilter).format("YYYY-MM-DD");q.value=u===e,console.log(q.value)};B=setInterval(()=>{p.value&&p.value&&p.value.resize()},1e3),Ve(()=>{clearInterval(B)}),xe(()=>{window.addEventListener("keyup",Se),pe()}),M(()=>T.value,()=>{K(),te(y.value)}),M(()=>o.initPlaybackData,()=>{pe(),F(),K(),N.value=!1,c.value&&(s.value=!0)});const te=u=>{W=[];for(let $ of H.value[o.selectedSpot].spot)G[$.name]=[];o.initPlaybackData.slice(0,u+1).forEach(($,i)=>{const fe=`${$.dateFilter} (${$.timeRange})`;W.push(fe),x.value=fe,$.data.forEach(ye=>{const _e=H.value[o.selectedSpot].spot.find($e=>$e.id===ye.idSpot).name,Fe=ye.avgPsiValues??0;G[_e][i]=Number(Fe.toFixed(2))})});const b=Object.keys(G).map($=>({name:$,type:"line",data:G[$],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(i){return i[0].value}},endLabel:{show:!0,formatter:function(i){return i.value+" ; "+$},color:"#000",backgroundColor:"inherit",padding:5,fontSize:10,borderRadius:5}}));p.value.setOption({xAxis:{data:W},series:b})},F=()=>{s.value=!1,y.value=0,O.value=[],clearInterval(_),te(y.value),E.value=y.value/o.initPlaybackData.length*100},we=u=>{s.value=!1,O.value=[],y.value=parseInt(u.target.value,10),te(y.value),E.value=y.value/o.initPlaybackData.length*100};M(()=>o.initDateFilter,()=>{ce()});const ce=()=>{const u=w(o.initDateFilter),e=u.add(1,"days").format("YYYY-MM-DD"),b=u.subtract(2,"days").format("YYYY-MM-DD");r.value=e,D.value=b};ce();const le=()=>{if(q.value)m.notifyShowError("End of playback");else{U.value=!0,F();const u=w(r.value).format("YYYY-MM-DD");c.value&&(s.value=!0),N.value=!0,Y("onDateChange",u),setTimeout(()=>{U.value=!1},5e3)}},ae=()=>{U.value=!0,F();const u=w(D.value).format("YYYY-MM-DD");c.value&&(s.value=!0),N.value=!0,Y("onDateChange",u),setTimeout(()=>{U.value=!1},5e3)};M(()=>n.value,()=>{n.value&&(Q(),h.value=!1,c.value=!1)}),M(()=>h.value,()=>{h.value?n.value=!1:n.value=!0}),M(()=>s.value,()=>{if(!s.value&&y.value==o.initPlaybackData.length)if(n.value)F(),s.value=!0;else{const u=w().format("YYYY-MM-DD"),e=w(o.initDateFilter).format("YYYY-MM-DD");u===e?s.value=!1:h.value?C.value=="forward"?V.value?(console.log(o.initDateFilter,A.value),o.initDateFilter!=z.value?le():oe.value?(F(),Y("onDateChange",A.value)):Q()):le():V.value?o.initDateFilter!=A.value?ae():oe.value?(F(),Y("onDateChange",z.value)):Q():ae():(F(),s.value=!0)}}),M(()=>[s.value,R.value],()=>{s.value?(_!=null&&clearInterval(_),_=setInterval(()=>{y.value<o.initPlaybackData.length?(y.value++,o.initPlaybackData[y.value]!=null&&(te(y.value),E.value=y.value/o.initPlaybackData.length*100)):(s.value=!1,clearInterval(_))},R.value)):_&&(clearInterval(_),_=null)}),M(()=>[m.asideVisible],()=>{setTimeout(()=>{p.value.resize()},1e3)});const J=l(!1),he=()=>C.value=="forward"?r.value:D.value,I=l(!1),V=l(!1),oe=l(!0),A=l(""),z=l(""),Me=()=>{A.value?z.value?(V.value=!0,n.value=!1,h.value=!0,c.value=!0,I.value=!1,s.value=!1):m.notifyShowError("Date 2 is required"):m.notifyShowError("Date 1 is required")};M(()=>I.value,()=>{I.value?(s.value=!1,V.value=!1):s.value=!0}),M(()=>[V.value],()=>{V.value&&(F(),C.value=="forward"?Y("onDateChange",A.value):Y("onDateChange",z.value))}),M(()=>C.value,()=>{C.value=="backward"&&(F(),Q())});const Q=()=>{F(),console.log(o.initDateFilter),Y("onDateChange",o.initDateFilter),V.value=!1,A.value=null,z.value=null},Se=u=>{(u.keyCode==80||u.keyCode==32)&&(s.value=!s.value),u.keyCode==37&&ae(),u.keyCode==39&&le()},Ye=()=>{const u=p.value.getOption().legend[0].selected;Object.keys(u).forEach(e=>{p.value.dispatchAction({type:"legendUnSelect",name:e})})},Ce=()=>{const u=p.value.getOption().legend[0].selected;Object.keys(u).forEach(e=>{p.value.dispatchAction({type:"legendSelect",name:e})})};return(u,e)=>{const b=re("font-awesome-icon"),$=re("center");return d(),v(Z,null,[I.value?(d(),v("div",Re,[t("div",Ue,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),a(X,{"in-label":"Speed","model-value":R.value,"onUpdate:modelValue":e[0]||(e[0]=i=>R.value=i)},{default:f(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),a(ie,{"in-type":"date","in-label":"Date 1","model-value":A.value,"onUpdate:modelValue":e[1]||(e[1]=i=>A.value=i)},null,8,["model-value"]),a(ie,{"in-type":"date","in-label":"Date 2","model-value":z.value,"onUpdate:modelValue":e[2]||(e[2]=i=>z.value=i)},null,8,["model-value"]),t("div",Ie,[a(S,{onClick:Me,"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[16]||(e[16]=[g("Apply Filter")])),_:1}),a(S,{onClick:e[3]||(e[3]=i=>I.value=!I.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[17]||(e[17]=[g("Cancel ")])),_:1})])])])):P("",!0),J.value?(d(),v("div",Ee,[t("div",Oe,[e[22]||(e[22]=t("h2",null,[t("b",null,"Select Preference")],-1)),a(X,{"in-label":"Select","model-value":C.value,"onUpdate:modelValue":e[4]||(e[4]=i=>C.value=i)},{default:f(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),a(S,{onClick:e[5]||(e[5]=i=>J.value=!J.value),style:{width:"fit-content"},"bt-disabled":!1},{default:f(()=>[a(b,{icon:"save"}),e[21]||(e[21]=g(" Save & Apply"))]),_:1})])])):P("",!0),e[35]||(e[35]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),a($,null,{default:f(()=>[a(X,{style:{width:"400px"},"in-label":"Speed","model-value":R.value,"onUpdate:modelValue":e[6]||(e[6]=i=>R.value=i)},{default:f(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",je,[t("div",Ne,[t("label",{class:j([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ne(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>n.value=i),type:"checkbox"},null,512),[[se,n.value]]),e[24]||(e[24]=g(" Auto-replay "))],2),t("label",{class:j([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ne(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>c.value=i),type:"checkbox"},null,512),[[se,c.value]]),e[25]||(e[25]=g(" Autoplay on navigating "))],2),t("label",{class:j([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ne(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>h.value=i),type:"checkbox"},null,512),[[se,h.value]]),e[26]||(e[26]=g(" Self Navigate "))],2),h.value?(d(),de(S,{key:0,onClick:e[10]||(e[10]=i=>J.value=!J.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[a(b,{icon:"sliders"})]),_:1})):P("",!0)]),t("div",Be,[V.value?(d(),v("label",{key:0,class:j([`${k(m).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[g(L(k(w)(A.value).format("ddd, DD MMM YY"))+"    ",1),a(b,{icon:C.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),g("    "+L(k(w)(z.value).format("ddd, DD MMM YY")),1)],2)):P("",!0),V.value?(d(),v("label",{key:1,class:j([`${k(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[ne(t("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>oe.value=i),type:"checkbox"},null,512),[[se,oe.value]]),e[27]||(e[27]=g(" Repeat "))],2)):P("",!0),a(S,{onClick:e[12]||(e[12]=i=>I.value=!I.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[a(b,{icon:"calendar"})]),_:1}),A.value&&z.value?(d(),de(S,{key:2,onClick:Q,"bt-disabled":!1,class:"slfnavbtn"},{default:f(()=>[a(b,{icon:"close"})]),_:1})):P("",!0)])]),t("div",qe,[a(S,{"bt-disabled":U.value,onClick:ae},{default:f(()=>[a(b,{icon:"backward"}),g("    "+L(k(w)(D.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Ge,[t("b",{style:Ae({color:`${k(m).accentColor}`})},L(k(w)(o.initDateFilter).format("ddd, DD MMM YY")),5),e[31]||(e[31]=t("br",null,null,-1)),V.value?(d(),v("span",{key:0,class:j([`${k(m).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=g("Stops at: ")),t("b",null,L(k(w)(z.value).format("ddd, DD MMM YY")),1)],2)):(d(),v(Z,{key:1},[n.value?(d(),v("span",Ke,[e[29]||(e[29]=g("Repeating: ")),t("b",null,L(k(w)(o.initDateFilter).format("ddd, DD MMM YY")),1)])):(d(),v(Z,{key:1},[q.value?(d(),v("span",We,"[End of playback  ·  Autoplay stopped]")):(d(),v("span",He,[e[30]||(e[30]=g("Upcoming: ")),t("b",null,L(k(w)(he()).format("ddd, DD MMM YY")),1)]))],64))],64))]),a(S,{"bt-disabled":U.value,onClick:le},{default:f(()=>[g(L(k(w)(r.value).format("ddd, DD MMM YY"))+"    ",1),a(b,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Je,[t("div",Qe,[a(S,{"bt-size":"small",onClick:Ce,"bt-disabled":!1},{default:f(()=>[a(b,{icon:"eye"}),e[32]||(e[32]=g(" Show All Legends"))]),_:1}),a(S,{"bt-size":"small",onClick:Ye,"bt-disabled":!1},{default:f(()=>e[33]||(e[33]=[g("Clear Legends")])),_:1})]),t("div",{ref_key:"heatMap",ref:T,style:{width:"100%",height:"600px"}},null,512),t("div",Xe,[t("div",Ze,[s.value?P("",!0):(d(),v("button",{key:0,style:{"z-index":"1",position:"relative"},onClick:e[13]||(e[13]=i=>s.value=!s.value),class:"controlbtn",type:"button"},[a(b,{icon:"play"})])),s.value?(d(),v("button",{key:1,style:{"z-index":"1",position:"relative"},onClick:e[14]||(e[14]=i=>s.value=!s.value),class:"controlbtn",type:"button"},[a(b,{icon:"pause"})])):P("",!0)]),t("div",et,[t("input",{onChange:we,type:"range",min:0,max:o.initPlaybackData.length,value:y.value,class:"slider"},null,40,tt)]),t("div",null,[!s.value&&y.value==o.initPlaybackData.length?(d(),v("button",{key:0,onClick:F,class:"controlbtn",type:"button"},[a(b,{icon:"undo"})])):P("",!0)])]),N.value?(d(),v("div",lt,e[34]||(e[34]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif"},null,-1)]))):P("",!0)])],64)}}}),ot=De(at,[["__scopeId","data-v-b0f2cc25"]]),nt={class:"row"},st={class:"col-md-3"},it=["value"],ut={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},rt={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},dt={class:"col-md-12",style:{position:"relative"}},vt={key:0,class:"loaders"},pt=ke({__name:"PlaybackFol",setup(ve){const ue=ge(),ee=be();ee.asideToggle(!1);const Y=l(ue.getAllTrunk()),m=l("trunk1"),C=l();C.value=Object.keys(Y.value);const h=l(5),o=l(),T=l([]),p=l(0),H=l([]),y=l(!1),E=l(!1),O=l(!1),N=()=>{p.value++,T.value.push(null)};xe(()=>{R(),setTimeout(()=>{y.value=!0},1e3)}),M(()=>[o.value,h.value,m.value],async()=>{E.value=!0,await B()});const R=()=>{const x=new Date,r=x.getFullYear(),D=String(x.getMonth()+1).padStart(2,"0"),n=String(x.getDate()).padStart(2,"0"),c=`${r}-${D}-${n}`;o.value=c},_=async x=>new Promise(async(r,D)=>{try{const n=Y.value[m.value];let c=[];for(let K=0;K<n.spot.length;K++)c.push(n.spot[K].id);const s={datefilter:x,timeFilter:h.value,idFilter:c},U=await Te.post(ze.baseEnd+"api/History/getsplittedhistdata",s);r(U.data)}catch(n){D(n)}}),B=async()=>{try{O.value=!0;let r=[...await _(o.value)];if(T.value.length>0){for(let D=0;D<T.value.length;D++){const n=T.value[D];if(n!==null){if(n.value!==o.value){const c=await _(n.value);r=r.concat(c)}}else console.log("Null")}E.value=!1}H.value=r,O.value=!1}catch(x){console.log(x),E.value=!1,O.value=!1}},q=(x,r)=>{T.value[r]=x,B()},W=()=>{p.value>0&&(p.value--,T.value.pop()),B()},G=x=>{o.value=x};return(x,r)=>{const D=re("font-awesome-icon");return d(),de(Pe,{"context-title":"Playback"},{default:f(()=>[t("div",nt,[t("div",st,[a(X,{"in-label":"Select Line","model-value":m.value,"onUpdate:modelValue":r[0]||(r[0]=n=>m.value=n)},{default:f(()=>[(d(!0),v(Z,null,me(C.value,(n,c)=>(d(),v("option",{key:c,value:n},L(Y.value[n].name),9,it))),128))]),_:1},8,["model-value"]),a(X,{"in-label":"Time Range","model-value":h.value,"onUpdate:modelValue":r[1]||(r[1]=n=>h.value=n)},{default:f(()=>r[3]||(r[3]=[t("option",{value:"1"},"1 Menit",-1),t("option",{value:"2"},"2 Menit",-1),t("option",{value:"3"},"3 Menit",-1),t("option",{value:"4"},"4 Menit",-1),t("option",{value:"5"},"5 Menit",-1),t("option",{value:"10"},"10 Menit",-1),t("option",{value:"15"},"15 Menit",-1),t("option",{value:"30"},"30 Menit",-1),t("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),t("div",ut,[a(ie,{"in-type":"date","in-label":"Date Filter","model-value":o.value,"onUpdate:modelValue":r[2]||(r[2]=n=>o.value=n),style:{width:"100%"}},null,8,["model-value"])]),t("div",rt,[a(S,{onClick:W,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[a(D,{icon:"minus"})]),_:1}),t("span",{class:j([`${k(ee).textTheme}`])},L(p.value),3),a(S,{onClick:N,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[a(D,{icon:"plus"})]),_:1})]),(d(!0),v(Z,null,me(p.value,(n,c)=>(d(),v("div",{key:c,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[a(ie,{"in-type":"date","in-label":`Date Filter ${n}`,onOnValueChange:s=>q(s,c),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",dt,[O.value&&y.value?(d(),v("div",vt,r[4]||(r[4]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):P("",!0),a(ot,{"init-date-filter":o.value,"selected-spot":m.value,"init-playback-data":H.value,onOnDateChange:G},null,8,["init-date-filter","selected-spot","init-playback-data"])])])]),_:1})}}}),ht=De(pt,[["__scopeId","data-v-7a2188c2"]]);export{ht as default};
